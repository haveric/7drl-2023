"use strict";(self.webpackChunk_7drl_2023=self.webpackChunk_7drl_2023||[]).push([[143],{890:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(537),s=n.n(o),a=n(645),i=n.n(a)()(s());i.push([e.id,'* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0 auto;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-size: 1.2vh;\n}\n\n.ui {\n    display: block;\n    z-index: -1000 !important;\n    opacity: 0;\n    pointer-events: none;\n}\n\n.ui.active {\n    z-index: 0 !important;\n    opacity: 1;\n    pointer-events: all;\n}\n\n\n.details {\n    padding: 10px 15px;\n    font-size: 2vh;\n    display: block;\n    width: 20%;\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ddd;\n}\n\n.details__header {\n    margin-top: 20px;\n}\n\n.details__line {\n    display: block;\n}\n\n.player-info {\n    height: calc(20vh - 10px);\n    border-bottom: 1px solid #000;\n}\n\n.view-info {\n    height: 30vh;\n    border-bottom: 1px solid #000;\n}\n\n.message-console {\n    position: relative;\n    height: calc(50vh - 10px);\n}\n\n.messages__wrap {\n    position: absolute;\n    opacity: 1;\n    padding: 15px 5px 5px;\n    width: 100%;\n    height: 100%;\n}\n\n.messages {\n    display:flex;\n    flex-direction:column-reverse;\n    height: 100%;\n    overflow-y: scroll;\n}\n\n\n.messages__inn {\n\n}\n\n.message {\n    font-size: 1.66vh;\n}\n\n.message__text {\n\n}\n\n.message__bold {\n    font-weight: bold;\n}\n\n.message__italics {\n    font-style: italic;\n}\n\n.message__amount {\n    margin-left: 1em;\n}\n\n\n.player-health,\n.hero-health {\n    position: relative;\n    width: 100%;\n    height: 2vh;\n    background-color: #000;\n}\n\n.player-health__fg,\n.hero-health__fg {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    background-color: #8B0000;\n}\n\n.player-health__text,\n.hero-health__text {\n    display: table;\n    position: absolute;\n    left: 0;\n    right: 0;\n    font-size: 1.8vh;\n    color: #fff;\n    margin: 0 auto;\n}\n\n.player-stat,\n.hero-stat {\n    display: inline-block;\n    float: left;\n    width: 50%;\n}\n\n.hero-info {\n    display: inline-block;\n    position: absolute;\n    left: 28%;\n    width: 21.5%;\n    padding: 15px;\n    font-size: 2vh;\n}\n\n.hero-status__message {\n    font-size: 2.5vh;\n}\n\n.inventory {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 30%;\n    height: 80%;\n    transform: translateX(100%);\n    transition: transform 1s ease;\n    background: #fff;\n    padding: 15px;\n}\n\n.inventory.active {\n    transform: translateX(0);\n}\n\n.inventory__equipment {\n    width: 100%;\n    height: 55%;\n    display: grid;\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    grid-template-rows: repeat(4, minmax(0, 1fr));\n    background-color: #333;\n    grid-gap: 0.2vw;\n    padding: 1vh 7.5vh\n}\n\n.inventory__storage-wrap {\n    width: 100%;\n    height: 40%;\n    background-color: #333;\n    position: relative;\n    overflow-y: auto;\n}\n\n.inventory__storage {\n    width: 100%;\n    display: grid;\n    grid-template-columns: repeat(10, minmax(0, 1fr));\n    grid-gap: 0.2vw;\n    padding: 0.2vw;\n}\n\n.inventory__storage-title {\n    grid-column: span 10;\n    padding: 5px;\n    background-color: #ccc;\n    font-size: 1.8vh;\n}\n\n.slot {\n    background-color: gray;\n    text-align: center;\n    border-radius: 5px;\n    position: relative;\n    font-family: helvetica, serif;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot .item {\n    font-size: 7.5vh;\n}\n\n.inventory__equipment-slot:before {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    font-size: 7.5vh;\n    opacity: 0.15;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot.has-item:before {\n    display: none;\n}\n\n.inventory__equipment-slot[data-index="0"]:before {\n    content: "⌈";\n}\n\n.inventory__equipment-slot[data-index="1"]:before {\n    content: "∩";\n}\n\n.inventory__equipment-slot[data-index="2"]:before {\n    content: "ᴕ";\n}\n\n.inventory__equipment-slot[data-index="3"]:before {\n    content: "†";\n    transform: rotate(180deg);\n}\n\n.inventory__equipment-slot[data-index="4"]:before {\n    content: "☗";\n}\n\n.inventory__equipment-slot[data-index="5"]:before {\n    content: "●";\n}\n\n.inventory__equipment-slot[data-index="6"]:before,\n.inventory__equipment-slot[data-index="8"]:before {\n    content: "○";\n}\n\n.inventory__equipment-slot[data-index="7"]:before {\n    content: "-";\n}\n\n.inventory__equipment-slot[data-index="9"]:before {\n    content: "ひ";\n}\n\n.inventory__equipment-slot[data-index="10"]:before {\n    content: "◫";\n}\n.inventory__equipment-slot[data-index="11"]:before {\n    content: "″";\n}\n\n.inventory__storage-slot {\n    height: 5.3vh;\n}\n\n.slot.has-item:hover {\n    cursor: pointer;\n    background-color: #999;\n}\n\n.slot.disabled {\n    background-color: #845b5b;\n}\n\n.slot.dragging .item {\n    display: none;\n}',"",{version:3,sources:["webpack://./src/styles/style.css"],names:[],mappings:"AAAA;IACI,sBAAsB;AAC1B;;AAEA;IACI,cAAc;IACd,gBAAgB;IAChB,YAAY;IACZ,aAAa;IACb,gBAAgB;AACpB;;AAEA;IACI,cAAc;IACd,yBAAyB;IACzB,UAAU;IACV,oBAAoB;AACxB;;AAEA;IACI,qBAAqB;IACrB,UAAU;IACV,mBAAmB;AACvB;;;AAGA;IACI,kBAAkB;IAClB,cAAc;IACd,cAAc;IACd,UAAU;IACV,kBAAkB;IAClB,MAAM;IACN,QAAQ;IACR,SAAS;IACT,sBAAsB;AAC1B;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,yBAAyB;IACzB,6BAA6B;AACjC;;AAEA;IACI,YAAY;IACZ,6BAA6B;AACjC;;AAEA;IACI,kBAAkB;IAClB,yBAAyB;AAC7B;;AAEA;IACI,kBAAkB;IAClB,UAAU;IACV,qBAAqB;IACrB,WAAW;IACX,YAAY;AAChB;;AAEA;IACI,YAAY;IACZ,6BAA6B;IAC7B,YAAY;IACZ,kBAAkB;AACtB;;;AAGA;;AAEA;;AAEA;IACI,iBAAiB;AACrB;;AAEA;;AAEA;;AAEA;IACI,iBAAiB;AACrB;;AAEA;IACI,kBAAkB;AACtB;;AAEA;IACI,gBAAgB;AACpB;;;AAGA;;IAEI,kBAAkB;IAClB,WAAW;IACX,WAAW;IACX,sBAAsB;AAC1B;;AAEA;;IAEI,kBAAkB;IAClB,MAAM;IACN,OAAO;IACP,SAAS;IACT,yBAAyB;AAC7B;;AAEA;;IAEI,cAAc;IACd,kBAAkB;IAClB,OAAO;IACP,QAAQ;IACR,gBAAgB;IAChB,WAAW;IACX,cAAc;AAClB;;AAEA;;IAEI,qBAAqB;IACrB,WAAW;IACX,UAAU;AACd;;AAEA;IACI,qBAAqB;IACrB,kBAAkB;IAClB,SAAS;IACT,YAAY;IACZ,aAAa;IACb,cAAc;AAClB;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,QAAQ;IACR,UAAU;IACV,WAAW;IACX,2BAA2B;IAC3B,6BAA6B;IAC7B,gBAAgB;IAChB,aAAa;AACjB;;AAEA;IACI,wBAAwB;AAC5B;;AAEA;IACI,WAAW;IACX,WAAW;IACX,aAAa;IACb,gDAAgD;IAChD,6CAA6C;IAC7C,sBAAsB;IACtB,eAAe;IACf;AACJ;;AAEA;IACI,WAAW;IACX,WAAW;IACX,sBAAsB;IACtB,kBAAkB;IAClB,gBAAgB;AACpB;;AAEA;IACI,WAAW;IACX,aAAa;IACb,iDAAiD;IACjD,eAAe;IACf,cAAc;AAClB;;AAEA;IACI,oBAAoB;IACpB,YAAY;IACZ,sBAAsB;IACtB,gBAAgB;AACpB;;AAEA;IACI,sBAAsB;IACtB,kBAAkB;IAClB,kBAAkB;IAClB,kBAAkB;IAClB,6BAA6B;IAC7B,aAAa;IACb,uBAAuB;IACvB,mBAAmB;AACvB;;AAEA;IACI,gBAAgB;AACpB;;AAEA;IACI,kBAAkB;IAClB,MAAM;IACN,OAAO;IACP,QAAQ;IACR,SAAS;IACT,WAAW;IACX,YAAY;IACZ,gBAAgB;IAChB,aAAa;IACb,aAAa;IACb,uBAAuB;IACvB,mBAAmB;AACvB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;IACZ,yBAAyB;AAC7B;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;;IAEI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;;AAEA;IACI,YAAY;AAChB;AACA;IACI,YAAY;AAChB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,eAAe;IACf,sBAAsB;AAC1B;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI,aAAa;AACjB",sourcesContent:['* {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0 auto;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n    font-size: 1.2vh;\n}\n\n.ui {\n    display: block;\n    z-index: -1000 !important;\n    opacity: 0;\n    pointer-events: none;\n}\n\n.ui.active {\n    z-index: 0 !important;\n    opacity: 1;\n    pointer-events: all;\n}\n\n\n.details {\n    padding: 10px 15px;\n    font-size: 2vh;\n    display: block;\n    width: 20%;\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ddd;\n}\n\n.details__header {\n    margin-top: 20px;\n}\n\n.details__line {\n    display: block;\n}\n\n.player-info {\n    height: calc(20vh - 10px);\n    border-bottom: 1px solid #000;\n}\n\n.view-info {\n    height: 30vh;\n    border-bottom: 1px solid #000;\n}\n\n.message-console {\n    position: relative;\n    height: calc(50vh - 10px);\n}\n\n.messages__wrap {\n    position: absolute;\n    opacity: 1;\n    padding: 15px 5px 5px;\n    width: 100%;\n    height: 100%;\n}\n\n.messages {\n    display:flex;\n    flex-direction:column-reverse;\n    height: 100%;\n    overflow-y: scroll;\n}\n\n\n.messages__inn {\n\n}\n\n.message {\n    font-size: 1.66vh;\n}\n\n.message__text {\n\n}\n\n.message__bold {\n    font-weight: bold;\n}\n\n.message__italics {\n    font-style: italic;\n}\n\n.message__amount {\n    margin-left: 1em;\n}\n\n\n.player-health,\n.hero-health {\n    position: relative;\n    width: 100%;\n    height: 2vh;\n    background-color: #000;\n}\n\n.player-health__fg,\n.hero-health__fg {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    background-color: #8B0000;\n}\n\n.player-health__text,\n.hero-health__text {\n    display: table;\n    position: absolute;\n    left: 0;\n    right: 0;\n    font-size: 1.8vh;\n    color: #fff;\n    margin: 0 auto;\n}\n\n.player-stat,\n.hero-stat {\n    display: inline-block;\n    float: left;\n    width: 50%;\n}\n\n.hero-info {\n    display: inline-block;\n    position: absolute;\n    left: 28%;\n    width: 21.5%;\n    padding: 15px;\n    font-size: 2vh;\n}\n\n.hero-status__message {\n    font-size: 2.5vh;\n}\n\n.inventory {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 30%;\n    height: 80%;\n    transform: translateX(100%);\n    transition: transform 1s ease;\n    background: #fff;\n    padding: 15px;\n}\n\n.inventory.active {\n    transform: translateX(0);\n}\n\n.inventory__equipment {\n    width: 100%;\n    height: 55%;\n    display: grid;\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n    grid-template-rows: repeat(4, minmax(0, 1fr));\n    background-color: #333;\n    grid-gap: 0.2vw;\n    padding: 1vh 7.5vh\n}\n\n.inventory__storage-wrap {\n    width: 100%;\n    height: 40%;\n    background-color: #333;\n    position: relative;\n    overflow-y: auto;\n}\n\n.inventory__storage {\n    width: 100%;\n    display: grid;\n    grid-template-columns: repeat(10, minmax(0, 1fr));\n    grid-gap: 0.2vw;\n    padding: 0.2vw;\n}\n\n.inventory__storage-title {\n    grid-column: span 10;\n    padding: 5px;\n    background-color: #ccc;\n    font-size: 1.8vh;\n}\n\n.slot {\n    background-color: gray;\n    text-align: center;\n    border-radius: 5px;\n    position: relative;\n    font-family: helvetica, serif;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot .item {\n    font-size: 7.5vh;\n}\n\n.inventory__equipment-slot:before {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    height: 100%;\n    font-size: 7.5vh;\n    opacity: 0.15;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.inventory__equipment-slot.has-item:before {\n    display: none;\n}\n\n.inventory__equipment-slot[data-index="0"]:before {\n    content: "⌈";\n}\n\n.inventory__equipment-slot[data-index="1"]:before {\n    content: "∩";\n}\n\n.inventory__equipment-slot[data-index="2"]:before {\n    content: "ᴕ";\n}\n\n.inventory__equipment-slot[data-index="3"]:before {\n    content: "†";\n    transform: rotate(180deg);\n}\n\n.inventory__equipment-slot[data-index="4"]:before {\n    content: "☗";\n}\n\n.inventory__equipment-slot[data-index="5"]:before {\n    content: "●";\n}\n\n.inventory__equipment-slot[data-index="6"]:before,\n.inventory__equipment-slot[data-index="8"]:before {\n    content: "○";\n}\n\n.inventory__equipment-slot[data-index="7"]:before {\n    content: "-";\n}\n\n.inventory__equipment-slot[data-index="9"]:before {\n    content: "ひ";\n}\n\n.inventory__equipment-slot[data-index="10"]:before {\n    content: "◫";\n}\n.inventory__equipment-slot[data-index="11"]:before {\n    content: "″";\n}\n\n.inventory__storage-slot {\n    height: 5.3vh;\n}\n\n.slot.has-item:hover {\n    cursor: pointer;\n    background-color: #999;\n}\n\n.slot.disabled {\n    background-color: #845b5b;\n}\n\n.slot.dragging .item {\n    display: none;\n}'],sourceRoot:""}]);const r=i},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(i[l]=!0)}for(var h=0;h<e.length;h++){var c=[].concat(e[h]);o&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),t.push(c))}},t}},537:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),a="/*# ".concat(s," */");return[t].concat([a]).join("\n")}return[t].join("\n")}},379:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var a={},i=[],r=0;r<e.length;r++){var l=e[r],h=o.base?l[0]+o.base:l[0],c=a[h]||0,d="".concat(h," ").concat(c);a[h]=c+1;var p=n(d),_={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(_);else{var m=s(_,o);o.byIndex=r,t.splice(r,0,{identifier:d,updater:m,references:1})}i.push(d)}return i}function s(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var a=o(e=e||[],s=s||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var r=n(a[i]);t[r].references--}for(var l=o(e,s),h=0;h<a.length;h++){var c=n(a[h]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}a=l}}},569:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,s&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},594:(e,t,n)=>{var o=n(379),s=n.n(o),a=n(795),i=n.n(a),r=n(569),l=n.n(r),h=n(565),c=n.n(h),d=n(216),p=n.n(d),_=n(589),m=n.n(_),u=n(890),g={};g.styleTagTransform=m(),g.setAttributes=c(),g.insert=l().bind(null,"head"),g.domAPI=i(),g.insertStyleElement=p(),s()(u.Z,g),u.Z&&u.Z.locals&&u.Z.locals;class f{constructor(e){this.entity=e}perform(){console.error("Not Implemented")}isPlayer(){return this.entity===H.player}}class b extends f{constructor(e){super(e)}perform(){return this}}class v extends f{constructor(e,t){super(e),this.reason=t}perform(){return this}}class A{constructor(e,t,n){this.text=e,this.color=t||"#333",this.bold=!1,this.italics=!1,n&&(this.bold=n.bold||!1,this.italics=n.italics||!1)}isEqual(e){return this.text===e.text&&this.color===e.color&&this.bold===e.bold&&this.italics===e.italics}}class y{constructor(e=[]){this.subMessages=e,this.count=1}isEqual(e){if(this.subMessages.length!==e.length)return!1;for(let t=0;t<this.subMessages.length;t++){const n=this.subMessages[t],o=e[t];if(!n.isEqual(o))return!1}return!0}getHtml(){const e=document.createElement("div");e.classList.add("message");for(const t of this.subMessages){const n=document.createElement("span");n.classList.add("message__text"),t.bold&&n.classList.add("message__bold"),t.italics&&n.classList.add("message__italics"),n.innerText=t.text,n.style.color=t.color,e.appendChild(n)}return this.count>1&&e.appendChild(this.getCountHtml()),e}getCountHtml(){const e=document.createElement("span");return e.classList.add("message__amount"),e.innerText="x"+this.count,e}}class w{constructor(e){this.dom=this.htmlToElement(e)}htmlToElement(e){const t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}appendTo(e){e.appendChild(this.dom)}isOpen(){return this.dom.classList.contains("active")}open(){this.dom.classList.contains("active")||this.dom.classList.add("active")}close(){this.dom.classList.remove("active")}}const x=new class extends w{constructor(){super('<div class="ui message-console">\n    <div class="messages__wrap">\n        <div class="messages">\n            <div class="messages__inn"></div>\n        </div>\n    </div>\n</div>'),this.messagesInnerDom=this.dom.getElementsByClassName("messages__inn")[0]}updateLastMessageCount(e){const t=document.querySelectorAll(".message:last-child")[0],n=t.querySelectorAll(".message__amount")[0];n?n.innerText="x"+e.count:t.appendChild(e.getCountHtml())}addMessage(e){this.messagesInnerDom.appendChild(e)}clear(){this.messagesInnerDom.innerHTML=""}},k=new class{constructor(){this.messages=[],this.builder=[]}text(e,t,n){return this.builder.push(new A(e,t,n)),this}build(e=!0){this.addMessage(this.builder.slice(0),e),this.builder=[]}clear(){this.messages=[],x.clear()}addMessage(e,t=!0){if(t&&this.messages.length>0){const t=this.messages[this.messages.length-1];t.isEqual(e)?(t.count+=1,x.updateLastMessageCount(t)):this.addNewMessage(e)}else this.addNewMessage(e)}addNewMessage(e){const t=new y(e);this.messages.push(t),x.addMessage(t.getHtml())}},C=k,I=new class extends w{constructor(){super('<div class="ui view-info">\n\n</div>')}updatePlayerDetails(){const e=H.player.getComponent("position"),t=H.playerMap.tiles[e.x][e.y];this.updatePositionDetails(t)}getDetailsLine(e){return"<span class='details__line'>"+e+"</span>"}updatePositionDetails(e){let t;const n=e.getComponent("fov");t=n&&n.explored?this.getDetailsLine(e.name):this.getDetailsLine("You haven't explored here."),this.dom.innerHTML=t}};class M{constructor(e,t){this.name=e,this.image=t}}class B{constructor(){this.textures=[]}addTexture(e,t){const n=this,o=new Image;o.onload=function(){n.textures.push(new M(e,o))},o.src=t}getTexture(e){const t=this.textures.length;for(let n=0;n<t;n++)if(this.textures[n].name===e)return this.textures[n].image;return null}loadJson(e,t){const n=t.tileSize,o=t.name,s=t.width,a=t.tiles;let i=0,r=0;for(const t of a)H.spriteManager.addImage(o+"_"+t,e,r*n,i*n),r++,r>=s&&(r-=s,i++)}}class T{constructor(e,t,n,o,s,a){this.imageName=e,this.textureName=t,this.texture=H.textureManager.getTexture(t),this.x=n,this.y=o,this.w=s||64,this.h=a||64}loadTexture(){return null===this.texture&&(this.texture=H.textureManager.getTexture(this.textureName)),null!==this.texture}drawImage(e,t,n,o){null!==o&&o>0?(e.save(),e.translate(t+this.w/2,n+this.h/2),e.rotate(o*Math.PI/180),e.drawImage(this.texture,this.x,this.y,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),e.restore()):e.drawImage(this.texture,this.x,this.y,this.w,this.h,t*H.xScale,n*H.yScale,this.w*H.xScale,this.h*H.yScale)}}class S{constructor(){this.sprites=[],this.spritesPreloaded=!1}addImage(e,t,n,o,s,a){this.sprites.push(new T(e,t,n,o,s,a))}getImage(e){const t=this.sprites.length;for(let n=0;n<t;n++)if(this.sprites[n].imageName===e)return this.sprites[n];return null}preloadSprites(){if(!this.spritesPreloaded){const e=this.sprites.length;let t=0;this.sprites.forEach((function(e){e.loadTexture()&&t++})),t===e&&(this.spritesPreloaded=!0)}return this.spritesPreloaded}}const E=n.p+"25dbe165d77e35f10dd9.gif",z=n.p+"5c5b2bc2ae027c4c410f.gif",D=n.p+"15f83941973a17ac63ff.png",F=JSON.parse('{"tileSize":64,"width":14,"name":"scribble","tiles":["tile","floor_path_curve","floor_wall_corner","floor_wall","floor_door_closed","floor_crate_small","floor_table","grass","path_curve","wall_corner","wall","door_closed","crate_small","table","tiles","floor_path","floor_wall_curve","floor_wall_half","floor_doorway","floor_barrel","floor_chair","crate","path","wall_curve","wall_half","doorway","barrel","chair","tiles_corner","floor_path_crossing","floor_wall_diagonal","floor_wall_damaged","floor_door_open","floor_barrels","floor_planks","trap_door","path_crossing","wall_diagonal","wall_damaged","door_open","barrels","planks","tiles_center","floor_track_curve","floor_wall_edge","floor_wall_secret","floor_trap","floor_barrels_stacked","floor_bed_luxurious","stairs_down","track_curve","wall_edge","wall_secret","trap","barrels_stacked","bed_luxurious","tiles_decorative","floor_track","floor_inner_round","floor_wall_trap","floor_chest","floor_arrow_curve","floor_bed","stairs_down_detail","track","inner_round","wall_trap","chest","arrow_curve","bed","tiles_cracked","floor_track_crossing","floor_inner_diagonal","floor_wall_demolished","floor_campfire","floor_arrow","floor_coffin","bridge","track_crossing","inner_diagonal","wall_demolished","campfire","arrow","coffin","wood","floor_track_cart","floor_inner_long_round","floor_trapdoor_square","floor_plants","floor_arrow_head","floor_puddle","bridge_end","track_cart","inner_long_round","trapdoor_square","plants","arrow_head","puddle","water","floor_cart","floor_inner_long_diagonal","floor_trapdoor_round","floor_tree","floor_arrow_circle","floor_dragon","carpet","cart","inner_long_diagonal","trapdoor_round","tree","arrow_circle","dragon","red_character","red_hand","purple_character","purple_hand","yellow_character","yellow_hand","green_character","green_hand","wall_full","blood_3","blood_2","blood_1","blank_0_4","blank_0_5","weapon_dagger","weapon_sword","weapon_longsword","weapon_pole","weapon_spear","weapon_bow_arrow","weapon_bow","weapon_arrow","blank_1_0","blank_1_1","blank_1_2","blank_1_3","blank_1_4","blank_1_5","weapon_axe_blades","weapon_axe_large","weapon_axe_double","weapon_axe","weapon_hammer","weapon_staff","shield_curved","shield_straight","blank_2_0","blank_2_1","blank_2_2","blank_2_3","blank_2_4","blank_2_5"]}'),N=n.p+"31a52256549002bddde2.png",L=JSON.parse('{"tileSize":64,"width":2,"name":"webs","tiles":["cobweb_large","cobweb"]}'),q=n.p+"ad367ee8b03fcda8629d.png",P=JSON.parse('{"tileSize":64,"width":30,"name":"rltiles","tiles":["shade","earth_elemental","fire_elemental","fog_cloud","death_cob","asmodeus","cerebov","dispater","ereshkigal","geryon","gloorx_vloq","lom_lobon","mnoleg","pandemonium_demon","shocking_sphere","flaming_sphere","balrog","blue_death","cacodemon","executioner","fiend","green_death","ice_fiend","pit_fiend","shadow_fiend","ice_devil","lorocyproca","reaper","soul_eater","sun_demon","blue_devil","demonic_crawler","hellion","hellwing","iron_devil","neqoxec","orange_demon","shadow_demon","tormentor","ynoxinul","beast","hairy_devil","red_devil","rotting_devil","smoke_demon","imp","lemure","manes","midge","shadow_imp","ufetubus","white_imp","clay_golem","glass_golem","electric_golem","iron_golem","stone_golem","toenail_golem","wood_golem","big_fish","electrical_eel","giant_goldfish","lava_fish","adolf","agnes","donald","duane","edmund","erica","frances","francis","glowing_shapeshifter","harold","hell_knight","human","jessica","joseph","josephine","jozef","killer_klown","louise","margery","maud","michael","necromancer","norbert","norris","psyche","rupert","shapeshifter","sigmund","terence","vault_guard","wayne","wizard","angel","boring_beetle","boulder_beetle","giant_beetle","program_bug","orion","cyclops","ettin","fire_giant","frost_giant","hill_giant","stone_giant","titan","green_dragon","golden_dragon","hydra1","hydra2","hydra3","hydra4","hydra5","white_dragon","iron_dragon","quicksilver_dragon","serpent_of_hell","black_dragon","skeletal_dragon","blue_dragon","swamp_dragon","wyvern","xtahua","efreet","blink_frog","giant_brown_frog","giant_frog","spiny_frog","eye_of_devastation","eye_of_draining","floating_eye","giant_orange_brain","gas_spore","great_orb_of_eyes","shining_eye","griffon","hippogriff","sphinx","ice_beast","acid_blob","spotted_jelly","brown_pudding","death_ooze","giant_amoeba","jelly","jellyfish","gray_ooze","pulsating_lump","lump_of_royal_jelly","green_slime","big_kobold","kobold","kobold_demonologist","ancient_lich","boris","lich","greater_mummy","guardian_mummy","mummy","mummy_priest","naga0","greater_naga0","naga_warrior0","guardian_naga","naga_mage","erolcha","ogre","ogre_mage","two_headed_ogre","oklob_plant","plant","queen_ant","queen_bee","rakshasa","rakshasa_fake","black_snake","brown_snake","grey_snake","lava_snake","salamander","garter_snake","snake","yellow_snake","water_troll","iron_troll","rock_troll","snorg","troll","bear","black_bear","grizzly_bear","polar_bear","vampire","vampire_knight","vampire_mage","freezing_wraith","shadow_wraith","spectral_thing","spectral_warrior","barrow_wight","wraith","juiblex","abomination_large1","abomination_large2","abomination_large3","abomination_large4","abomination_large5","abomination_large6","orb_guardian","tentacled_monstrosity","death_yak","sheep","yak","simulacrum_large","skeleton","giant_zombie","giant_ant","giant_cockroach","soldier_ant","butterfly","butterfly1","butterfly2","butterfly3","butterfly4","butterfly5","butterfly6","giant_bat","plains_centaur","centaur_warrior","yaktaur","yaktaur_captain","firedrake","lindwurm","mottled_dragon","steam_dragon","swamp_drake","elf","deep_elf_fighter0","deep_elf_soldier0","deep_elf_knight0","deep_elf_mage","deep_elf_sorcerer","deep_elf_conjurer","deep_elf_death_mage","deep_elf_demonologist","deep_elf_summoner","deep_elf_annihilator","deep_elf_priest","deep_elf_high_priest","fungus","wandering_mushroom","goblin0","hobgoblin0","gnoll0","ijyb","boggart","gargoyle","metal_gargoyle","molten_gargoyle","hell_hog","hell_hound","hog","hound","warg","war_dog","wolf","jackal","bumblebee","killer_bee","gecko","giant_iguana","giant_lizard","newt","gila_monster","komodo_dragon","elephant_slug","giant_slug","giant_snail","manticore","minotaur","ghoul","necrophage","rotting_hulk","orc0","orc_warrior0","orc_knight0","orc_warlord0","blork_the_orc0","urug0","orc_priest","orc_high_priest","orc_sorcerer","orc_wizard","flayed_ghost","hungry_ghost","insubstantial_wisp","phantom","ghost","quasit","green_rat","sewer_rat","orange_rat","quokka","rat","centipede","giant_mite","redback","scorpion","giant_spider","ugly_thing","very_ugly_thing","air_elemental","fire_vortex","spatial_vortex","killer_bee_larva","brain_worm","lava_worm","spiny_worm","swamp_worm","worm","abomination_small","unseen_horror","giant_blowfly","giant_mosquito","moth_of_wrath","red_wasp","curse_skull","curse_toe","flying_skull","simulacrum_small","skeletal_warrior","orc_zombie","water_elemental","fire_ant","quivering_blob","gelatinous_cube","chickatrice","cockatrice","pyrolisk","fox","coyote","werejackal","little_dog","dog","large_dog","dingo","werewolf","winter_wolf_cub","winter_wolf","hell_hound_pup","cerberus","freezing_sphere","beholder","kitten","housecat","jaguar","lynx","panther","large_cat","tiger","gremlin","winged_gargoyle","hobbit","dwarf","bugbear","dwarf_lord","dwarf_king","mind_flayer","master_mind_flayer","homunculus","tengu","blue_jelly","ochre_jelly","large_kobold","kobold_lord","kobold_shaman","leprechaun","small_mimic","large_mimic","giant_mimic","wood_nymph","water_nymph","mountain_nymph","goblin","hobgoblin","orc","hill_orc","mordor_orc","uruk-hai","orc_shaman","orc-captain","rock_piercer","iron_piercer","glass_piercer","rothe","mumak","leocrotta","wumpus","titanothere","baluchitherium","mastodon","giant_rat","rabid_rat","wererat","rock_mole","woodchuck","cave_spider","lurker_above","trapper","white_unicorn","gray_unicorn","black_unicorn","pony","horse","warhorse","dust_vortex","ice_vortex","energy_vortex","steam_vortex","baby_long_worm","baby_purple_worm","long_worm","purple_worm","grid_bug","xan","yellow_light","black_light","zruty","couatl","aleax","ki-rin","archon","bat","raven","vampire_bat","forest_centaur","mountain_centaur","baby_gray_dragon","baby_silver_dragon","baby_shimmering_dragon","baby_red_dragon","baby_white_dragon","baby_orange_dragon","baby_black_dragon","baby_blue_dragon","baby_green_dragon","baby_yellow_dragon","gray_dragon","silver_dragon","shimmering_dragon","red_dragon","orange_dragon","yellow_dragon","stalker","lichen","brown_mold","yellow_mold","green_mold","red_mold","shrieker","violet_fungus","gnome","gnome_lord","gnomish_wizard","gnome_king","giant","storm_giant","jabberwock","vorpal_jabberwock","keystone_kop","kop_sergeant","kop_lieutenant","kop_kaptain","demilich","master_lich","arch-lich","kobold_mummy","gnome_mummy","orc_mummy","dwarf_mummy","elf_mummy","human_mummy","ettin_mummy","giant_mummy","red_naga_hatchling","black_naga_hatchling","golden_naga_hatchling","guardian_naga_hatchling","red_naga","black_naga","golden_naga","ogre_lord","ogre_king","black_pudding","quantum_mechanic","rust_monster","disenchanter","water_moccasin","pit_viper","python","cobra","ice_troll","olog-hai","umber_hulk","vampire_lord","vlad_the_impaler","nazgul","xorn","monkey","ape","owlbear","yeti","carnivorous_ape","sasquatch","kobold_zombie","gnome_zombie","dwarf_zombie","elf_zombie","human_zombie","ettin_zombie","straw_golem","paper_golem","rope_golem","gold_golem","leather_golem","flesh_golem","woodland-elf","green-elf","grey-elf","elf-lord","elvenking","doppelganger","nurse","shopkeeper","guard","prisoner","oracle","aligned_priest","high_priest","soldier","sergeant","lieutenant","captain","watchman","watch_captain","medusa","wizard_of_yendor","croesus","charon","water_demon","horned_devil","succubus","incubus","erinys","barbed_devil","marilith","vrock","hezrou","bone_devil","nalfeshnee","yeenoghu","orcus","baalzebub","demogorgon","death","pestilence","famine","mail_daemon","djinni","sandestin","piranha","shark","giant_eel","electric_eel","kraken","iguana","baby_crocodile","lizard","chameleon","crocodile","long_worm_tail","archeologist","barbarian","caveman","cavewoman","healer","knight","monk","priest","priestess","ranger","rogue","samurai","tourist","valkyrie","lord_carnarvon","pelias","shaman_karnov","earendil","elwing","hippocrates","king_arthur","grand_master","arch_priest","master_of_thieves","lord_sato","twoflower","norn","wizard_of_balance","minion_of_huhetotl","thoth_amon","chromatic_dragon","goblin_king","ixoth","master_kaen","nalzok","scorpius","master_assassin","ashikaga_takauji","lord_surtur","dark_one","student","chieftain","neanderthal","high-elf","attendant","page","abbot","acolyte","hunter","thug","ninja","roshi","guide","warrior","apprentice","invisible_monster","strange_object","spwpn_singing_sword","spwpn_wrath_of_trog","spwpn_scythe_of_curses","spwpn_mace_of_variability","spwpn_glaive_of_prune","spwpn_sceptre_of_torment","spwpn_sword_of_zonguldrok","spwpn_sword_of_cerebov","spwpn_staff_of_dispater","spwpn_sceptre_of_asmodeus","spwpn_sword_of_power","spwpn_knife_of_accuracy","spwpn_staff_of_olgreb","spwpn_vampires_tooth","quarterstaff","urand_bloodbane","urand_fkaming_death","urand_brilliance","urand_leech","urand_chilly_death","urand_morg","urand_finisher","urand_punk","urand_krishna","urand_skullcrusher","urand_guard","urand_jihad","urand_fiery_devil","urand_doom_knight","urand_eos","urand_voo_doo","urand_octopus_king","urand_arga","urand_elemental","urand_sniper","urand_erchidel","urand_plutonium","urand_undeadhunter","urand_ignorance","urand_zin","urand_augmentation","urand_thief","urand_bullseye","urand_dyrovepreva","urand_misfortune","urand_flash","urand_assassin","urand_lear","urand_zhor","urand_salamander","urand_war","urand_resistance","urand_folly","urand_edison","urand_dragonmask","urand_night","urand_dragon_king","urand_alchemist","urand_fencer","urand_shadows","urand_shaolin","urand_robustness","urand_mage","urand_cekugob","urand_four_winds","urand_bloodlust","club","mace2","mace_large","mace_large2","flail2","flail","flail_angmar","morningstar2","eveningstar","hammer","ancus","bullwhip","demon_whip","giant_club","giant_spiked_club","knife","dagger","orcish_dagger","elven_dagger","short_sword","short_sword2","orcish_short_sword","elven_short_sword","long_sword2","long_sword3","orcish_long_sword","greatsword","greatsword2","orcish_great_sword","falchion","scimitar","silver_saber","sabre2","quickblade","katana2","katana3","double_sword","triple_sword","demon_blade","hand_axe","war_axe","battle_axe2","broad_axe2","battle_axe","battle_axe3","executioner_axe","executioner_axe2","blowgun","sling","bow","crossbow","crossbow2","glaive","orcish_glaive","elven_spear","spear2","halberd","scythe","trident","demon_trident","stone","ya","arrow0","arrow1","arrow2","arrow3","arrow4","arrow5","arrow6","arrow7","crossbow_bolt","bolt0","bolt1","bolt2","bolt3","bolt4","bolt5","bolt6","bolt7","dart","dart-p","dart0","dart1","dart2","dart3","dart4","dart5","dart6","dart7","needle","needle-p","needle0","needle1","needle2","needle3","needle4","needle5","needle6","needle7","rock","robe","robe2","robe3","leather_armor2","breast_plate2","leather_armor4","orcish_leather_armor","elven_leather_armor","ring_mail","ring_mail2","orcish_ringmail","elven_ringmail","dwarven_ringmail","scale_mail","scale_mail2","elven_scalemail","chain_mail1","chain_mail2","orcish_chain_mail","splint_mail","banded_mail","plate_mail2","orcish_platemail","crystal_plate_mail","animal_skin","animal_skin2","troll_hide","troll_leather_armour","green_dragon_scales","green_dragon_scale_mail","ice_dragon_hide","ice_dragon_armour","silver_dragon_scales","silver_dragon_scale_mail","mottled_dragon_hide","mpttled_dragon_armour","blue_dragon_scales","blue_dragon_scale_mail","gold_dragon_hide","gold_dragon_armour","swamp_dragon_hide","swamp_dragon_armour","elven_shield","shield_kite2","shield_round2","small_shield","small_shield2","large_shield","shield_large2","shield_kite3","leather_cloak","cloak2","cloak3","cloak4","elven_leather_helm","wizard_hat","wizard_hat2","visored_helmet","etched_helmet","helm3","helm_visor1","glove1","glove3","glove5","gauntlet2","boots_brown1","jackboots","boots_stripe1","boots_green2","gem_iron","gem_brass","gem_bone","gem_wood","gem_copper","gem_gold","gem_silver","gem_bronze","gem_ivory","gem_glass","gem_lead","gem_plastic","i-flame","i-frost","i-slowing","i-hasting","i-magic_darts","i-healing","i-paralysis","i-fire","i-cold","i-confusion","i-invisibility","i-digging","i-fireball","i-teleportation","i-lightning","i-polymorph_other","i-enslavement","i-draining","i-random_effects","i-disintegration","tripe_ration","bread_ration","pear","apple","choko","honeycomb","snozzcumber","pizza","apricot","orange","banana","strawberry","rambutan","lemon","grape","sultana","lychee","beef_jerky","cheese","sausage","corpse","corpse_rotten","bone","kernod_wel","i-identify","i-fear","i-noise","i-remove_curse","i-detect_curse","i-summoning","i-enchant-weapon1","i-enchant_armour","i-torment","i-random_uselessness","i-curse_weapon","i-curse_armour","i-immolation","i-blinking","blank_paper","i-magic_mapping","i-foregetfulness","i-acquirement","i-enchant-weapon2","i-vorpalize-weapon","i-recharging","i-enchant-weapon3","wooden","silver","gold","iron","steel","bronze","brass","copper","granite","ivory","clay","tiger_eye","jade","glass","agate","diamond","emerald","gold_green","gold_red","opal","pearl","coral","gold_blue","plain_red","plain_yellow","plain_black","moonstone","crystal_white","stone3_blue","face1_gold","stone3_green","stone2_red","eye_magenta","face2","penta_orange","celtic_red","cameo_blue","bone_gray","cylinder_gray","ring_green","ring_cyan","crystal_green","cameo_orange","celtic_blue","eye_cyan","penta_green","ring_red","stone1_cyan","stone1_pink","stone2_green","stone3_magenta","celtic_yellow","stone1_green","stone2_blue","crystal_red","eye_green","clear","brilliant_blue","black","cyan","magenta","dark","ruby","yellow","brown","pink","white","i-heal","i-heal-wounds","i-speed","i-might","i-gain-strength","i-gain-dexterity","i-gain-intelligence","i-levitation","i-poison","i-porridge","i-degeneration","i-decay","i-water","i-experience","i-magic","i-restore-abilities","i-strong-poison","i-berserk-rage","i-cure-mutation","i-mutation","book_of_the_dead","dark_blue","dark_green","red","purple","tan","light_gray","dark_gray","light_blue","light_green","turquoise","parchment","leather","plaid","light_brown","dark_brown","glittering","metal_blue","metal_cyan","metal_green","cloth","staff00","staff01","staff02","staff03","staff04","staff05","staff06","staff07","staff08","staff09","misc_orb","misc_bottle","misc_crystal","misc_fan","misc_lamp","misc_stone","misc_lantern","misc_horn","misc_box","misc_deck","misc_disc","misc_rune","misc_altar","gold_piece","arrow","elven_arrow","orcish_arrow","silver_arrow","shuriken","boomerang","spear","orcish_spear","dwarvish_spear","silver_spear","javelin","silver_dagger","athame","scalpel","stiletto","worm_tooth","crysknife","axe","dwarvish_short_sword","broadsword","elven_broadsword","long_sword","two_handed_sword","katana","tsurugi","runesword","partisan","ranseur","spetum","lance","bardiche","voulge","dwarvish_mattock","fauchard","guisarme","bill_guisarme","lucern_hammer","bec_de_corbin","mace","morning_star","war_hammer","rubber_hose","aklys","elven_bow","orcish_bow","yumi","orcish_helm","dwarvish_iron_helm","fedora","cornuthaum","dunce_cap","dented_pot","plumed_helmet","crested_helmet","gray_dragon_scale_mail","shimmering_dragon_scale_mail","red_dragon_scale_mail","white_dragon_scale_mail","orange_dragon_scale_mail","black_dragon_scale_mail","yellow_dragon_scale_mail","gray_dragon_scales","shimmering_dragon_scales","red_dragon_scales","white_dragon_scales","orange_dragon_scales","black_dragon_scales","yellow_dragon_scales","plate_mail","bronze_plate_mail","dwarvish_mithril_coat","elven_mithril_coat","chain_mail","studded_leather_armor","orcish_ring_mail","leather_armor","leather_jacket","hawaiian_shirt","t_shirt","mummy_wrapping","elven_cloak","orcish_cloak","dwarvish_cloak","oilskin_cloak","alchemy_smock","tattered_cape","opera_cloak","ornamental_cope","piece_of_cloth","uruk_hai_shield","orcish_shield","dwarvish_roundshield","shield_of_reflection","old_gloves","padded_gloves","riding_gloves","fencing_gloves","low_boots","iron_shoes","combat_boots","jungle_boots","hiking_boots","mud_boots","buckled_boots","riding_boots","snow_boots","black_onyx","topaz","sapphire","twisted","wire","engagement","shiny","circular","spherical","oval","triangular","pyramidal","square","concave","hexagonal","octagonal","amulet_of_yendor","large_box","chest","ice_box","sack","skeleton_key","lock_pick","credit_card","tallow_candle","wax_candle","brass_lantern","lamp","expensive_camera","mirror","crystal_ball","lenses","blindfold","towel","saddle","leash","stethoscope","tinning_kit","tin_opener","can_of_grease","figurine","magic_marker","land_mine","beartrap","whistle","flute","horn","harp","bell","bugle","drum","pick_axe","grappling_hook","unicorn_horn","candelabrum_of_invocation","bell_of_opening","egg","meatball","meat_stick","huge_chunk_of_meat","meat_ring","kelp_frond","eucalyptus_leaf","melon","carrot","sprig_of_wolfsbane","clove_of_garlic","slime_mold","cream_pie","candy_bar","fortune_cookie","pancake","lembas_wafer","cram_ration","food_ration","k_ration","c_ration","tin","sky_blue","purple_red","puce","milky","swirly","bubbly","smoky","cloudy","effervescent","golden","fizzy","murky","zelgo_mer","juyed_awk_yacc","nr_9","xixaxa_xoxaxa_xuxaxa","pratyavayah","daiyen_fooels","lep_gex_ven_zea","prirutsenie","elbib_yloh","verr_yed_horre","venzar_borgavve","tharr","yum_yum","elam_ebow","duam_xnaht","andova_begarin","kirje","ve_forbryderne","hackem_muche","velox_neb","foobie_bletch","temov","garven_deh","read_me","mail","vellum","ragged","dog_eared","mottled","stained","velvet","indigo","violet","gray","wrinkled","dusty","shining","dull","thin","thick","balsa","crystal","maple","pine","oak","ebony","marble","platinum","iridium","zinc","aluminum","uranium","short","runed","long","curved","forked","spiked","jeweled","blue","green","yellowish_brown","grey_stone","boulder","statue","heavy_iron_ball","iron_chain","blank","dark_part_of_a_room","dngn_rock_wall_00","dngn_rock_wall_01","dngn_rock_wall_02","dngn_rock_wall_03","dngn_rock_wall_04","dngn_rock_wall_05","dngn_rock_wall_06","dngn_rock_wall_07","dngn_rock_wall_08","dngn_rock_wall_09","dngn_rock_wall_10","dngn_rock_wall_11","dngn_rock_wall_12","dngn_rock_wall_13","dngn_rock_wall_14","dngn_rock_wall_15","dngn_stone_wall","dngn_closed_door","dngn_metal_wall","dngn_green_crystal_wall","dngn_orcish_idol","dngn_wax_wall","dngn_silver_statue","dngn_granite_statue","dngn_orange_crystal_statue","dngn_lava","dngn_deep_water","dngn_shallow_water","floor_of_a_room","dngn_enter_hell","dngn_open_door","staircase_down","dngn_trap_mechanical","dngn_trap_magical","dngn_trap_iii","dngn_enter_shop","dngn_enter_labyrinth","staircase_up","dngn_enter_dis","dngn_enter_gehenna","dngn_enter_cocytus","dngn_enter_tartarus","dngn_enter_abyss","dngn_exit","dngn_stone_arch","dngn_enter_pandemonium","dngn_transit_pandemonium","dngn_enter","dngn_return","dngn_altar_zin","dngn_altar_shining_one","dngn_altar_kikubaaqudgha","dngn_altar_yredelemnul","dngn_altar_xom","dngn_altar_vehumet","dngn_altar_okawaru","dngn_altar_makhleb","dngn_altar_sif_muna","dngn_altar_trog","dngn_altar_nemelex_xobeh","dngn_altar_elyvilon","dngn_blue_fountain","dngn_dry_fountain","dngn_sparkling_fountain","blinding_venom","acid_venom","wall_main00","wall_main01","wall_main02","wall_main03","wall_main04","wall_main05","wall_main06","wall_main07","wall_main08","wall_main09","wall_main10","doorway","open_door_h","open_door_v","closed_door_h","closed_door_v","iron_bars","tree","corridor","lit_corridor","ladder_up","ladder_down","altar","grave","opulent_throne","sink","fountain","water","ice","molten_lava","lowered_drawbridge_v","lowered_drawbridge_h","raised_drawbridge_v","raised_drawbridge_h","air","cloud","arrow_trap","dart_trap","falling_rock_trap","squeaky_board","bear_trap","rolling_boulder_trap","sleeping_gas_trap","rust_trap","fire_trap","pit","spiked_pit","hole","trap_door","teleportation_trap","level_teleporter","magic_portal","web","statue_trap","magic_trap","anti_magic_trap_field","polymorph_trap","zigzag1","zigzag2","zigzag3","zigzag4","zap_dig","zap_flash","boomerang1","boomerang2","resist1","resist2","resist3","resist4","engulf1","engulf2","engulf3","engulf4","engulf5","engulf6","engulf7","engulf8","explode_black0","explode_black1","explode_black2","explode_black3","explode_black4","explode_black5","explode_black6","explode_black7","explode_black8","explode_green0","explode_green1","explode_green2","explode_green3","explode_green4","explode_green5","explode_green6","explode_green7","explode_green8","explode_brown0","explode_brown1","explode_brown2","explode_brown3","explode_brown4","explode_brown5","explode_brown6","explode_brown7","explode_brown8","explode_blue0","explode_blue1","explode_blue2","explode_blue3","explode_blue4","explode_blue5","explode_blue6","explode_blue7","explode_blue8","explode_purple0","explode_purple1","explode_purple2","explode_purple3","explode_purple4","explode_purple5","explode_purple6","explode_purple7","explode_purple8","explode_red0","explode_red1","explode_red2","explode_red3","explode_red4","explode_red5","explode_red6","explode_red7","explode_red8","explode_darkblue0","explode_darkblue1","explode_darkblue2","explode_darkblue3","explode_darkblue4","explode_darkblue5","explode_darkblue6","explode_darkblue7","explode_darkblue8","zap_magic0","zap_magic1","zap_magic2","zap_magic3","zap_fire0","zap_fire1","zap_fire2","zap_fire3","zap_ice0","zap_ice1","zap_ice2","zap_ice3","zap_sleep0","zap_sleep1","zap_sleep2","zap_sleep3","zap_black0","zap_black1","zap_black2","zap_black3","zap_elec0","zap_elec1","zap_elec2","zap_elec3","zap_gas0","zap_gas1","zap_gas2","zap_gas3","zap_acid0","zap_acid1","zap_acid2","zap_acid3","question1","question2","question3","question4","question5","question6","wall_mine00","wall_mine01","wall_mine02","wall_mine03","wall_mine04","wall_mine05","wall_mine06","wall_mine07","wall_mine08","wall_mine09","wall_mine10","wall_gehennom00","wall_gehennom01","wall_gehennom02","wall_gehennom03","wall_gehennom04","wall_gehennom05","wall_gehennom06","wall_gehennom07","wall_gehennom08","wall_gehennom09","wall_gehennom10","wall_knox00","wall_knox01","wall_knox02","wall_knox03","wall_knox04","wall_knox05","wall_knox06","wall_knox07","wall_knox08","wall_knox09","wall_knox10","wall_sokoban00","wall_sokoban01","wall_sokoban02","wall_sokoban03","wall_sokoban04","wall_sokoban05","wall_sokoban06","wall_sokoban07","wall_sokoban08","wall_sokoban09","wall_sokoban10"]}'),O=new class{constructor(){this.eventHandler=null,this.player=null,this.gameMaps=new Map,this.playerMap=null,this.heroMap=null,this.nextMap=null,this.shopMap=null,this.needsRenderUpdate=!1,this.textureManager=null,this.spriteManager=null,this.xScale=1,this.yScale=1}initTextures(){this.textureManager=new B,this.textureManager.addTexture("sprites",E),this.textureManager.addTexture("player",z),this.textureManager.addTexture("scribble",D),this.textureManager.addTexture("rltiles",q),this.textureManager.addTexture("webs",N),this.spriteManager=new S,this.spriteManager.addImage("placeholder","sprites",0,0),this.textureManager.loadJson("rltiles",P),this.textureManager.loadJson("scribble",F),this.textureManager.loadJson("webs",L)}handleEvents(){this.processAction(this.eventHandler.handleInput())}processAction(e){if(e&&this.eventHandler.isPlayerTurn){const t=e.perform(O.playerMap);return!(t instanceof b||(t instanceof v?(t.reason&&C.text(t.reason).build(),1):(O.needsRenderUpdate=!0,O.player.fov.compute(O.playerMap,O.player,5),O.player.fov.updateMap(),I.updatePlayerDetails(),this.handleEnemyTurns(),0)))}}handleEnemyTurns(){this.eventHandler.isPlayerTurn=!1;for(const e of this.heroMap.actors)if(e!==this.player){const t=e.getComponent("ai");t&&t.perform(this.heroMap)}for(const e of this.shopMap.actors)if(e!==this.player){const t=e.getComponent("ai");t&&t.perform(this.shopMap)}for(const e of this.nextMap.actors)if(e!==this.player){const t=e.getComponent("ai");t&&t.perform(this.nextMap)}this.eventHandler.isPlayerTurn=!0}clearMaps(){this.player=null,this.gameMaps=new Map}setHeroMap(e){const t=this.heroMap;t!==e&&(t&&(t.teardown(),t.removeActor(this.player)),this.heroMap=e,this.addMap(e),t&&t.save(),e.save(),this.player&&-1===this.heroMap.actors.indexOf(this.player)&&this.heroMap.actors.push(this.player),this.heroMap.updatePlayerUI(),this.needsRenderUpdate=!0)}setNextMap(e){const t=this.nextMap;t!==e&&(t&&(t.teardown(),t.removeActor(this.player)),this.nextMap=e,this.addMap(e),t&&t.save(),e.save(),this.player&&-1===this.nextMap.actors.indexOf(this.player)&&this.nextMap.actors.push(this.player),this.nextMap.updatePlayerUI(),this.needsRenderUpdate=!0)}setShopMap(e){const t=this.shopMap;t!==e&&(t&&(t.teardown(),t.removeActor(this.player)),this.shopMap=e,this.addMap(e),t&&t.save(),e.save(),this.player&&-1===this.shopMap.actors.indexOf(this.player)&&this.shopMap.actors.push(this.player),this.shopMap.updatePlayerUI(),this.needsRenderUpdate=!0)}addMap(e){this.gameMaps.has(e.name)||this.gameMaps.set(e.name,e)}draw(){this.heroMap.draw(),this.nextMap.draw(0,11),this.shopMap.draw(20,0)}save(e){const t=[];for(const e of this.gameMaps.values())t.push(e.save());const n={name:e,date:new Date,playerMap:this.playerMap.name,heroMap:this.heroMap.name,nextMap:this.nextMap.name,shopMap:this.shopMap.name,maps:t};localStorage.setItem(e,JSON.stringify(n))}load(){}},H=O;class j{constructor(){this.mouse={x:-1,y:-1},this.mouseDown=!1,window.addEventListener("mousemove",this),window.addEventListener("mousedown",this),window.addEventListener("mouseup",this),window.addEventListener("click",this),window.addEventListener("contextmenu",this),window.addEventListener("change",this),window.addEventListener("keydown",this),this.isPlayerTurn=!0,this.targetedTile=null,this.pathTiles=[]}teardown(){window.removeEventListener("mousemove",this),window.removeEventListener("mousedown",this),window.removeEventListener("mouseup",this),window.removeEventListener("click",this),window.removeEventListener("contextmenu",this),window.removeEventListener("change",this),window.removeEventListener("keydown",this)}handleEvent(e){switch(e.type){case"mousemove":this.onMouseMove(e);break;case"mousedown":this.onMouseDown(e);break;case"mouseup":this.onMouseUp(e);break;case"click":this.onLeftClick(e);break;case"contextmenu":this.onRightClick(e);break;case"change":this.onChange(e);break;case"keydown":this.onKeydown(e)}}handleInput(){}onMouseMove(){}onMouseDown(){this.mouseDown=!0}onMouseUp(){this.mouseDown=!1}onLeftClick(){}onRightClick(){}onChange(){}onKeydown(){}}const U="ArrowLeft",R="ArrowRight",Y="ArrowUp",W="ArrowDown",J="Left Shift",G="Right Shift",X="Numpad .",V="Numpad 0",Z="Numpad 1",K="Numpad 2",Q="Numpad 3",$="Numpad 4",ee="Numpad 5",te="Numpad 6",ne="Numpad 7",oe="Numpad 8",se="Numpad 9",ae="Numpad Delete",ie="Numpad Insert",re="Numpad End",le="Numpad ArrowDown",he="Numpad PageDown",ce="Numpad ArrowLeft",de="Numpad Clear",pe="Numpad ArrowRight",_e="Numpad Home",me="Numpad ArrowUp",ue="Numpad PageUp",ge=new class{constructor(){const e=this;e.defaultDelay=25,e.lastShiftUp=null,e.treatShiftNumpadEqual=!0,e.keysDown=[],e.keysDelayed=[],e.defaults=new Map,e.controls=new Map,e.defaults.set("up",[oe,Y]),e.defaults.set("down",[K,W]),e.defaults.set("left",[$,U]),e.defaults.set("right",[te,R]),e.defaults.set("nw",[ne]),e.defaults.set("ne",[se]),e.defaults.set("sw",[Z]),e.defaults.set("se",[Q]),e.defaults.set("wait",[ee]),e.load(),addEventListener("keydown",(function(t){"/"===t.key&&t.preventDefault(),e.treatShiftNumpadEqual&&t.getModifierState("NumLock")&&!t.shiftKey&&t.code.startsWith("Numpad")&&t.keyCode<90&&e.lastShiftUp&&(e.keysDown[e.lastShiftUp]=!0);const n=e.getKey(t.key,t.code);e.keysDown[n]=!0}),!1),addEventListener("keyup",(function(t){const n=e.getKey(t.key,t.code);n!==J&&n!==G||(e.lastShiftUp=n),delete e.keysDown[n],delete e.keysDelayed[n]}),!1)}getKey(e,t){if(t.startsWith("Arrow")||(t.endsWith("Left")?e="Left "+e:t.endsWith("Right")?e="Right "+e:t.startsWith("Numpad")&&(e="Numpad "+e)),this.treatShiftNumpadEqual)switch(e){case ae:e=X;break;case ie:e=V;break;case re:e=Z;break;case le:e=K;break;case he:e=Q;break;case ce:e=$;break;case de:e=ee;break;case pe:e=te;break;case _e:e=ne;break;case me:e=oe;break;case ue:e=se}return e}load(){const e=localStorage.getItem("controls");e?this.controls=new Map(JSON.parse(e)):this.resetToDefault()}save(){localStorage.setItem("controls",JSON.stringify(Array.from(this.controls.entries())))}setControls(e){this.controls=new Map;for(const[t,n]of e.entries()){const e=[];for(const t of n)e.push(t);this.controls.set(t,e)}this.save()}resetToDefault(){this.setControls(this.defaults)}clone(){const e=new Map;for(const[t,n]of this.controls.entries()){const o=[];for(const e of n)o.push(e);e.set(t,o)}return e}isPressed(e){const t=this;let n=!1,o=t.controls.get(e);if(!o){const n=t.defaults.get(e);n?(t.controls.set(e,n),t.save(),o=n):console.error("Missing keybindings for: ",e,o)}return o.forEach((function(e){e in t.keysDown&&(n=!0)})),n}isDelayed(e){const t=this;let n=!1;return this.controls.get(e).forEach((function(e){e in t.keysDelayed&&(n=!0)})),n}deleteKey(e,t){const n=this;n.controls.get(e).forEach((function(e){delete n.keysDown[e],t&&(n.keysDelayed[e]=!0)})),t&&setTimeout((function(){n.controls.get(e).forEach((function(e){delete n.keysDelayed[e]}))}),t)}testPressed(e,t){t=t||this.defaultDelay;const n=this;let o=!1;return n.isPressed(e)&&!n.isDelayed(e)&&(n.deleteKey(e,t),o=!0),o}};class fe extends f{constructor(e,t=0,n=0){super(e),this.dx=t,this.dy=n}perform(){console.error("Not Implemented")}}class be extends fe{constructor(e,t=0,n=0){super(e,t,n)}perform(e){const t=this.entity.getComponent("position");if(!t)return new v(this.entity,"Entity doesn't have a position.");const n=t.x+this.dx,o=t.y+this.dy;if(!e.isInBounds(n,o))return new v(this.entity,"Location is outside the map!");const s=this.tryMoveTo(e,n,o);return s instanceof v||t.move(this.dx,this.dy),s}tryMoveTo(e,t,n){if(e.getBlockingActorAtLocation(t,n))return new v(this.entity,"There's something in the way!");const o=e.tiles[t][n];if(o){const e=o.getComponent("blocksMovement");if(e&&e.blocksMovement)return new v(this.entity,"There's a "+o.name+" in the way!")}return this}}class ve extends fe{constructor(e,t=0,n=0){super(e,t,n)}perform(e){const t=this.entity.getComponent("position");if(!t)return new v(this.entity,"Entity doesn't have a position.");const n=t.x+this.dx,o=t.y+this.dy,s=e.getBlockingActorAtLocation(n,o);if(!s)return new v(this.entity,"There's nothing to attack there!");{const e=this.entity.getComponent("fighter"),t=s.getComponent("fighter");if(e&&t){let n,o,a,i;this.isPlayer()?(n="You",o=""):(n=this.entity.name,o="s"),s===H.player?(a="You",i="#C00"):(a=s.name,i="#999");const r=n+" attack"+o+" "+a,l=e.getDamage()-t.getBlockedDamage();l>0?(C.text(r+" for "+l+" hit points.",i).build(),t.takeDamage(l)):C.text(r+", but does no damage.",i).build(),this.entity.callEvent("onMeleeAttack",s)}}}}class Ae{constructor(e={},t,n){this.args=e,this.baseType=t||"component",this.type=n||this.baseType,this.parentEntity=e.parentEntity,this.cachedSave=null}clearSaveCache(){this.cachedSave=null,this.parentEntity?.clearSaveCache()}save(){return null}hasComponent(){return this.args.components&&void 0!==this.args.components[this.type]}isPlayer(){return this.parentEntity===H.player}saveBoolean(e,t){if(this.cachedSave)return this.cachedSave;const n={};return e!==t&&(n[this.type]=e),this.cachedSave=n,n}loadBooleanOrObject(e){const t=typeof this.args.components[this.type];return"boolean"===t?this.args.components[this.type]:"object"===t?this.args.components[this.type][e]:void 0}loadArg(e,t){return this.args.components[this.type][e]||t}loadArgArray(e){const t=[],n=this.args.components[this.type][e].split(",");for(const e of n)t.push(e.trim());return t}}class ye extends Ae{constructor(e){super(e,"fov"),this.explored=!1,this.visible=!1,this.hasComponent()&&(this.explored=this.loadArg("explored",!1),this.visible=this.loadArg("visible",!1))}save(){if(this.cachedSave)return this.cachedSave;const e={fov:{}};return!1!==this.explored&&(e.fov.explored=this.explored),!1!==this.visible&&(e.fov.visible=this.visible),this.cachedSave=e,e}setExplored(e){this.explored=e,this.clearSaveCache()}setVisible(e){this.visible=e}}class we{constructor(){this.previousVisibleTiles=[],this.visibleTiles=[],this.visibleActors=[],this.visibleItems=[],this.left=0,this.right=0,this.top=0,this.bottom=0}teardown(){this.previousVisibleTiles=[],this.visibleTiles=[],this.visibleActors=[],this.visibleItems=[]}compute(e,t,n,o){this.previousVisibleTiles=this.visibleTiles,this.visibleTiles=[],this.visibleActors=[],this.visibleItems=[],this.left=Math.max(0,t-o),this.right=Math.min(e.width,t+o+1),this.top=Math.max(0,n-o),this.bottom=Math.min(e.height,n+o+1)}addVisibleTile(e){-1===this.visibleTiles.indexOf(e)&&this.visibleTiles.push(e)}addVisibleActor(e){-1===this.visibleActors.indexOf(e)&&this.visibleActors.push(e)}addVisibleItem(e){-1===this.visibleItems.indexOf(e)&&this.visibleItems.push(e)}exploreTile(e,t,n){const o=e.tiles[t];if(o){const e=o[n];e&&this.addVisibleTile(e)}for(const o of e.actors){const e=o.getComponent("position");e&&e.x===t&&e.y===n&&this.addVisibleActor(o)}for(const o of e.items){const e=o.getComponent("position");e&&e.x===t&&e.y===n&&this.addVisibleItem(o)}}updateMap(){for(const e of this.previousVisibleTiles){const t=e.getComponent("fov");t&&t.setVisible(!1)}for(const e of this.visibleTiles){const t=e.getComponent("fov");t?(t.setExplored(!0),t.setVisible(!0)):e.setComponent(new ye({components:{fov:{explored:!0,visible:!0}}}))}}}class xe{constructor(e,t){this.y=e,this.x=t}greater(e,t){return this.y*t>this.x*e}greaterOrEqual(e,t){return this.y*t>=this.x*e}lessOrEqual(e,t){return this.y*t<=this.x*e}}class ke extends we{constructor(){super()}compute(e,t,n,o){super.compute(e,t,n,o),this.exploreTile(e,t,n);for(let s=0;s<8;s++)this.computeOctant(e,s,t,n,o,1,new xe(1,1),new xe(0,1))}computeOctant(e,t,n,o,s,a,i,r){for(;a<=s;a++){let l,h;if(1===i.x)l=a;else if(l=Math.round(((2*a-1)*i.y+i.x)/(2*i.x)),this.blocksLight(e,t,n,o,a,l))i.greaterOrEqual(2*l+1,2*a)&&!this.blocksLight(e,t,n,o,a,l+1)&&l++;else{let s=2*a;this.blocksLight(e,t,n,o,a+1,l+1)&&s++,i.greater(2*l+1,s)&&l++}0===r.y?h=0:(h=((2*a-1)*r.y+r.x)/(2*r.x),r.greaterOrEqual(2*h+1,2*a)&&this.blocksLight(e,t,n,o,a,h)&&!this.blocksLight(e,t,n,o,a,h+1)&&h++);let c=-1;for(let d=l;d>=h;d--){const p=this.blocksLight(e,t,n,o,a,d);if((p||(d!==l||i.greaterOrEqual(d,a))&&(d!==h||r.lessOrEqual(d,a)))&&this.setVisible(e,t,n,o,a,d),a!==s)if(p){if(0===c){const l=2*a,c=2*d+1;if(i.greater(c,l)){if(d===h){r=new xe(c,l);break}this.computeOctant(e,t,n,o,s,a+1,i,new xe(c,l))}else if(d===h)return}c=1}else{if(c>0){const e=2*a,t=2*d+1;if(r.greaterOrEqual(t,e))return;i=new xe(t,e)}c=0}}if(0!==c)break}}blocksLight(e,t,n,o,s,a){switch(t){case 0:n+=s,o-=a;break;case 1:n+=a,o-=s;break;case 2:n-=a,o-=s;break;case 3:n-=s,o-=a;break;case 4:n-=s,o+=a;break;case 5:n-=a,o+=s;break;case 6:n+=a,o+=s;break;case 7:n+=s,o+=a}let i=!1;const r=e.tiles;if(r[n]){const e=r[n][o];if(e){const t=e.getComponent("blocksFov");t&&(i=t.blocksFov)}}return i}setVisible(e,t,n,o,s,a){switch(t){case 0:n+=s,o-=a;break;case 1:n+=a,o-=s;break;case 2:n-=a,o-=s;break;case 3:n-=s,o-=a;break;case 4:n-=s,o+=a;break;case 5:n-=a,o+=s;break;case 6:n+=a,o+=s;break;case 7:n+=s,o+=a}this.exploreTile(e,n,o)}}class Ce{constructor(){}static extend(e){e=e||{};for(let t=1;t<arguments.length;t++)if(arguments[t])for(const n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}static deep(e){e=e||{};for(let t=1;t<arguments.length;t++){const n=arguments[t];if(n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&("object"==typeof n[t]?n[t]instanceof Array?e[t]=n[t].slice(0):e[t]=Ce.deep(e[t],n[t]):"boolean"==typeof e&&void 0===e[t]?e=n[t]:e[t]=n[t])}return e}}class Ie extends Ae{constructor(e={},t){super(e,"ai",t)}save(){return super.save()}perform(){console.error("Not Implemented")}}class Me extends Ie{constructor(e={}){super(e,"aiDead"),this.previousAI="",this.hasComponent()&&(this.previousAI=this.loadArg("previousAI",""))}save(){if(this.cachedSave)return this.cachedSave;const e={aiDead:{}};return e.aiDead.previousAI=this.previousAI,this.cachedSave=e,e}perform(){}}const Be=new class extends w{constructor(){super('<div class="ui hero-info">\n    <div class="hero-status">\n        <div class="hero-status__message"></div>\n    </div>\n    <div class="hero-health">\n        <div class="hero-health__fg"></div>\n        <div class="hero-health__text"></div>\n    </div>\n    <div class="hero-stats">\n        <div class="hero-stat">Power: <span class="hero-power"></span></div>\n        <div class="hero-stat">Defense: <span class="hero-defense"></span></div>\n    </div>\n    <div class="hero-inventory"></div>\n</div>'),this.statusMessageDom=this.dom.getElementsByClassName("hero-status__message")[0],this.healthFgDom=this.dom.getElementsByClassName("hero-health__fg")[0],this.healthTextDom=this.dom.getElementsByClassName("hero-health__text")[0],this.powerDom=this.dom.getElementsByClassName("hero-power")[0],this.defenseDom=this.dom.getElementsByClassName("hero-defense")[0],this.inventoryDom=this.dom.getElementsByClassName("hero-inventory")[0]}updateStatus(e){this.statusMessageDom.innerText=e}updateHealth(e,t){const n=e/t*100;this.healthFgDom.style.width=n+"%",this.healthTextDom.innerText="HP: "+e+" / "+t}updatePower(e){this.powerDom.innerText=e}updateDefense(e){this.defenseDom.innerText=e}updateInventory(){}};class Te extends Ae{constructor(e={}){super(e,"position"),this.x=0,this.y=0,this.hasComponent()&&(this.x=this.loadArg("x",0),this.y=this.loadArg("y",0))}save(){if(this.cachedSave)return this.cachedSave;const e={position:{}};return e.position.x=this.x,e.position.y=this.y,this.cachedSave=e,e}moveTo(e,t){this.x=e,this.y=t,this.clearSaveCache()}move(e,t){this.x+=e,this.y+=t,this.clearSaveCache()}setX(e){this.x=e,this.clearSaveCache()}setY(e){this.y=e,this.clearSaveCache()}}class Se{constructor(){}static randomInt(e,t){return Math.floor(Math.random()*(t-e+1)+e)}static randomNumber(e,t){return Math.random()*(t-e)+e}}class Ee extends f{constructor(e){super(e)}perform(){return this}}class ze extends f{constructor(e){super(e)}perform(e){const t=Se.randomInt(-1,1),n=Se.randomInt(-1,1);return 0===t&&0===n?new Ee(this.entity).perform(e):new be(this.entity,t,n).perform(e)}}class De{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e}remove(e){const t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const t=this.content[e];for(;e>0;){const n=(e+1>>1)-1,o=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(o)))break;this.content[n]=t,this.content[e]=o,e=n}}bubbleUp(e){const t=this.content.length,n=this.content[e],o=this.scoreFunction(n);let s=!1;for(;!s;){const a=e+1<<1,i=a-1;let r,l=null;if(i<t){const e=this.content[i];r=this.scoreFunction(e),r<o&&(l=i)}if(a<t){const e=this.content[a];this.scoreFunction(e)<(null===l?o:r)&&(l=a)}if(null===l){s=!0;break}this.content[e]=this.content[l],this.content[l]=n,e=l}}}class Fe{constructor(){}static pathTo(e){let t=e;const n=[];for(;t.parent;)n.unshift(t),t=t.parent;return n}static getHeap(){return new De((function(e){return e.f}))}static search(e,t,n,o){e.cleanDirty(),o=o||{},this.heuristicType=o.heuristic||"manhattan";const s=o.closest||!1,a=this.getHeap();let i=t;for("manhattan"===this.heuristicType?t.h=this.heuristicManhattan(t,n):"diagonal"===this.heuristicType&&this.heuristicDiagonal(t,n),e.markDirty(t),a.push(t);a.size()>0;){const t=a.pop();if(t===n)return this.pathTo(t);t.closed=!0;const o=e.neighbors(t);for(let r=0,l=o.length;r<l;++r){const l=o[r];if(l.closed||l.isWall())continue;const h=t.g+l.getCost(t),c=l.visited;(!c||h<l.g)&&(l.visited=!0,l.parent=t,"manhattan"===this.heuristicType?l.h=l.h||this.heuristicManhattan(l,n):"diagonal"===this.heuristicType&&(l.h=l.h||this.heuristicDiagonal(l,n)),l.g=h,l.f=l.g+l.h,e.markDirty(l),s&&(l.h<i.h||l.h===i.h&&l.g<i.g)&&(i=l),c?a.rescoreElement(l):a.push(l))}}return s?this.pathTo(i):[]}static heuristicManhattan(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static heuristicDiagonal(e,t){const n=Math.sqrt(2),o=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return 1*(o+s)+(n-2)*Math.min(o,s)}static cleanNode(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}}class Ne{constructor(e,t,n){this.x=e,this.y=t,this.weight=n}toString(){return"["+this.x+" "+this.y+"]"}getCost(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight}isWall(){return 0===this.weight}}class Le{constructor(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(let t=0;t<e.length;t++){this.grid[t]=[];for(let n=0,o=e[t];n<o.length;n++){const e=new Ne(t,n,o[n]);this.grid[t][n]=e,this.nodes.push(e)}}this.init()}init(){this.dirtyNodes=[];for(let e=0;e<this.nodes.length;e++)Fe.cleanNode(this.nodes[e])}cleanDirty(){for(let e=0;e<this.dirtyNodes.length;e++)Fe.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]}markDirty(e){this.dirtyNodes.push(e)}neighbors(e){const t=[],n=e.x,o=e.y,s=this.grid;return s[n-1]&&s[n-1][o]&&t.push(s[n-1][o]),s[n+1]&&s[n+1][o]&&t.push(s[n+1][o]),s[n]&&s[n][o-1]&&t.push(s[n][o-1]),s[n]&&s[n][o+1]&&t.push(s[n][o+1]),this.diagonal&&(s[n-1]&&s[n-1][o-1]&&t.push(s[n-1][o-1]),s[n+1]&&s[n+1][o-1]&&t.push(s[n+1][o-1]),s[n-1]&&s[n-1][o+1]&&t.push(s[n-1][o+1]),s[n+1]&&s[n+1][o+1]&&t.push(s[n+1][o+1])),t}toString(){const e=[],t=this.grid;for(let n=0;n<t.length;n++){const o=[],s=t[n];for(let e=0;e<s.length;e++)o.push(s[e].weight);e.push(o.join(" "))}return e.join("\n")}}class qe extends Ie{constructor(e={}){super(e,"aiHero"),this.fov=new ke,this.chaseLocation=null,this.radius=10,this.movementActions=1,this.currentMovement=0,this.turnsToEnterDungeon=30,this.status="Hero will arrive in "+this.turnsToEnterDungeon+" turns.",this.hasComponent()&&(this.radius=this.loadArg("radius",10),this.movementActions=this.loadArg("movementActions",1),this.currentMovement=this.loadArg("currentMovement",0),this.turnsToEnterDungeon=this.loadArg("turnsToEnterDungeon",30),this.status=this.loadArg("status","Hero will arrive in "+this.turnsToEnterDungeon+" turns.")),this.updateUIStatus()}save(){if(this.cachedSave)return this.cachedSave;const e={aiHero:{}};return 10!==this.radius&&(e.aiHero.radius=this.radius),1!==this.movementActions&&(e.aiHero.movementActions=this.movementActions),0!==this.currentMovement&&(e.aiHero.currentMovement=this.currentMovement),e.aiHero.turnsToEnterDungeon=this.turnsToEnterDungeon,e.aiHero.status=this.status,this.cachedSave=e,e}decreaseTurnsToEnterDungeon(){this.turnsToEnterDungeon--,this.clearSaveCache()}setStatus(e){this.status=e,this.updateUIStatus(),this.clearSaveCache()}updateUIStatus(){Be.updateStatus(this.status)}perform(e){const t=this.parentEntity;if(this.turnsToEnterDungeon>0)this.decreaseTurnsToEnterDungeon(),this.setStatus("Hero will arrive in "+this.turnsToEnterDungeon+" turns.");else if(0===this.turnsToEnterDungeon)t.setComponent(new Te({components:{position:{x:5,y:0}}})),this.decreaseTurnsToEnterDungeon(),this.setStatus("Hero has entered the dungeon!");else{const n=t.getComponent("position");if(n){this.fov.compute(e,n.x,n.y,this.radius);let o=[],s=null;const a=t.getComponent("faction");if(a)for(const e of this.fov.visibleActors)if(e.isAlive()){const t=e.getComponent("faction");if(a.isEnemyOf(t)){const t=e.getComponent("position");if(t){const a=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y),r=Math.max(a,i);null===s||r<s?(o=[],o.push(e),s=r):r===s&&o.push(e)}}}let i;if(1===o.length?i=o[0]:o.length>1&&(i=o[Se.randomInt(0,o.length-1)]),i){const o=i.getComponent("position");if(this.chaseLocation={x:o.x,y:o.y},s<=1)return this.setStatus("Hero is fighting "+i.name+"!"),new ve(t,o.x-n.x,o.y-n.y).perform(e);this.setStatus("Hero is moving to attack "+i.name+".")}else if(null!==this.chaseLocation&&this.chaseLocation.x===n.x&&this.chaseLocation.y===n.y&&(this.chaseLocation=null),null===this.chaseLocation)return new ze(t).perform(e);if(this.currentMovement+=this.movementActions,this.currentMovement>=1){const o=this.fov.right-this.fov.left,s=this.fov.bottom-this.fov.top,a=Array(o).fill().map((()=>Array(s).fill(0)));for(let t=this.fov.left;t<this.fov.right;t++)for(let n=this.fov.top;n<this.fov.bottom;n++){const o=e.tiles[t][n];if(o){const e=o.getComponent("blocksMovement");if(e&&e.blocksMovement)continue;a[t-this.fov.left][n-this.fov.top]+=10}}for(const e of this.fov.visibleActors)if(e.isAlive()){const t=e.getComponent("position");t&&(a[t.x-this.fov.left][t.y-this.fov.top]+=100)}const i=new Le(a,{diagonal:!0}),r=i.grid[n.x-this.fov.left][n.y-this.fov.top],l=i.grid[this.chaseLocation.x-this.fov.left][this.chaseLocation.y-this.fov.top],h=Fe.search(i,r,l);let c;for(;this.currentMovement>=1;){if(h&&h.length>0){const o=h.shift();o&&(c=new dt(t,o.x+this.fov.left-n.x,o.y+this.fov.top-n.y).perform(e))}else c=new Ee(t).perform(e);this.currentMovement-=1}return c}}}}}class Pe extends Ie{constructor(e={}){super(e,"aiMeleeChase"),this.fov=new ke,this.chaseLocation=null,this.radius=5,this.movementActions=1,this.currentMovement=0,this.hasComponent()&&(this.radius=this.loadArg("radius",5),this.movementActions=this.loadArg("movementActions",1),this.currentMovement=this.loadArg("currentMovement",0))}save(){if(this.cachedSave)return this.cachedSave;const e={aiMeleeChase:{}};return 5!==this.radius&&(e.aiMeleeChase.radius=this.radius),1!==this.movementActions&&(e.aiMeleeChase.movementActions=this.movementActions),0!==this.currentMovement&&(e.aiMeleeChase.currentMovement=this.currentMovement),this.cachedSave=e,e}perform(e){const t=this.parentEntity,n=t.getComponent("position");if(n){this.fov.compute(e,n.x,n.y,this.radius);let o=[],s=null;const a=t.getComponent("faction");if(a)for(const e of this.fov.visibleActors)if(e.isAlive()){const t=e.getComponent("faction");if(a.isEnemyOf(t)){const t=e.getComponent("position");if(t){const a=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y),r=Math.max(a,i);null===s||r<s?(o=[],o.push(e),s=r):r===s&&o.push(e)}}}let i;if(1===o.length?i=o[0]:o.length>1&&(i=o[Se.randomInt(0,o.length-1)]),i){const o=i.getComponent("position");if(this.chaseLocation={x:o.x,y:o.y},s<=1)return new ve(t,o.x-n.x,o.y-n.y).perform(e)}else if(null!==this.chaseLocation&&this.chaseLocation.x===n.x&&this.chaseLocation.y===n.y&&(this.chaseLocation=null),null===this.chaseLocation)return new ze(t).perform(e);if(this.currentMovement+=this.movementActions,this.currentMovement>=1){const o=this.fov.right-this.fov.left,s=this.fov.bottom-this.fov.top,a=Array(o).fill().map((()=>Array(s).fill(0)));for(let t=this.fov.left;t<this.fov.right;t++)for(let n=this.fov.top;n<this.fov.bottom;n++){const o=e.tiles[t][n];if(o){const e=o.getComponent("blocksMovement");if(e&&e.blocksMovement)continue;a[t-this.fov.left][n-this.fov.top]+=10}}for(const e of this.fov.visibleActors)if(e.isAlive()){const t=e.getComponent("position");t&&(a[t.x-this.fov.left][t.y-this.fov.top]+=100)}const i=new Le(a,{diagonal:!0}),r=i.grid[n.x-this.fov.left][n.y-this.fov.top],l=i.grid[this.chaseLocation.x-this.fov.left][this.chaseLocation.y-this.fov.top],h=Fe.search(i,r,l);let c;for(;this.currentMovement>=1;){if(h&&h.length>0){const o=h.shift();o&&(c=new dt(t,o.x+this.fov.left-n.x,o.y+this.fov.top-n.y).perform(e))}else c=new Ee(t).perform(e);this.currentMovement-=1}return c}}}}class Oe extends Ae{constructor(e={}){super(e,"blocksFov"),this.blocksFov=!1,this.hasComponent()&&(this.blocksFov=this.loadBooleanOrObject("blocksFov"))}save(){return this.saveBoolean(this.blocksFov,!1)}}class He extends Ae{constructor(e={}){super(e,"blocksMovement"),this.blocksMovement=!1,this.hasComponent()&&(this.blocksMovement=this.loadBooleanOrObject("blocksMovement"))}save(){return this.saveBoolean(this.blocksMovement,!1)}onEntityDeath(){this.blocksMovement=!1,this.clearSaveCache()}}class je extends Ae{constructor(e={}){super(e,"cleanable"),this.decreasesTo="",this.increasesTo="",this.hasComponent()&&(this.decreasesTo=this.loadArg("decreasesTo",""),this.increasesTo=this.loadArg("increasesTo",""))}save(){if(this.cachedSave)return this.cachedSave;const e={cleanable:{}};return e.cleanable.decreasesTo=this.decreasesTo,e.cleanable.increasesTo=this.increasesTo,this.cachedSave=e,e}perform(){}}class Ue extends Ae{constructor(e={}){super(e,"faction"),this.factions=[],this.enemies=[],this.hasComponent()&&(this.factions=this.loadArgArray("factions"),this.enemies=this.loadArgArray("enemies"))}save(){if(this.cachedSave)return this.cachedSave;const e={faction:{}};return e.faction.factions=this.factions.toString(),e.faction.enemies=this.enemies.toString(),this.cachedSave=e,e}isEnemyOf(e){if(!e)return!1;for(const t of this.factions)if(e.enemies.indexOf(t)>-1)return!0;return!1}}const Re=new class extends w{constructor(){super('<div class="ui player-info">\n    <div class="player-health">\n        <div class="player-health__fg"></div>\n        <div class="player-health__text"></div>\n    </div>\n    <div class="player-stats">\n        <div class="player-stat">Power: <span class="player-power"></span></div>\n        <div class="player-stat">Defense: <span class="player-defense"></span></div>\n    </div>\n</div>'),this.healthFgDom=this.dom.getElementsByClassName("player-health__fg")[0],this.healthTextDom=this.dom.getElementsByClassName("player-health__text")[0],this.powerDom=this.dom.getElementsByClassName("player-power")[0],this.defenseDom=this.dom.getElementsByClassName("player-defense")[0]}updateHealth(e,t){const n=e/t*100;this.healthFgDom.style.width=n+"%",this.healthTextDom.innerText="HP: "+e+" / "+t}updatePower(e){this.powerDom.innerText=e}updateDefense(e){this.defenseDom.innerText=e}};class Ye extends Ae{constructor(e){super(e,"fighter"),this.baseHp=0,this.hp=null,this.baseDefense=0,this.baseDamage=0,this.hasComponent()&&(this.baseHp=this.loadArg("baseHp",0),this.hp=this.loadArg("hp",null),this.baseDefense=this.loadArg("baseDefense",0),this.baseDamage=this.loadArg("baseDamage",0)),this.minDamage=0,this.maxDamage=0,this.defense=0}save(){if(this.cachedSave)return this.cachedSave;const e={fighter:{}};return e.fighter.baseHp=this.baseHp,e.fighter.hp=this.hp,e.fighter.maxHp=this.maxHp,e.fighter.baseDefense=this.baseDefense,e.fighter.baseDamage=this.baseDamage,this.cachedSave=e,e}setHp(e){this.hp=Math.max(0,Math.min(e,this.maxHp)),this.updateUI(),this.clearSaveCache()}heal(e){if(this.hp===this.maxHp)return 0;const t=Math.min(this.maxHp,this.hp+e),n=t-this.hp;return this.setHp(t),n}takeDamage(e){this.setHp(this.hp-e),this.hp<=0&&this.die()}die(){const e=this.parentEntity;this.isPlayer()?C.text("You died!","#f00").build():C.text(e.name+" dies!","#ffa030").build(),e.callEvent("onEntityDeath");const t=e.getComponent("ai");if(t){const n={components:{aiDead:{previousAI:t.type}}};e.removeComponent("ai"),e.setComponent(new Me(n))}e.sprite="rltiles_corpse",e.name="Corpse of "+this.name,this.clearSaveCache()}getDamage(){return this.minDamage===this.maxDamage?this.minDamage:Se.randomInt(this.minDamage,this.maxDamage)}getDamageDisplay(){return this.minDamage===this.maxDamage?this.minDamage:this.minDamage+" - "+this.maxDamage}getBlockedDamage(){return Math.floor(Se.randomNumber(this.defense/10,this.defense)/10)}getMaxHp(){const e=this.baseHp;let t=0;const n=this.parentEntity.getComponent("equipment");if(n){const e=n.getEquippables();for(const n of e)t+=n.health}return e+t}recalculateStats(e=!0){const t=this.getMaxHp();(null===this.hp||this.hp>=this.maxHp)&&(this.hp=t),this.maxHp=t,this.calculateDamage(),this.calculateDefense(),this.updateUI(),e&&this.clearSaveCache()}calculateDamage(){const e=this.baseDamage;let t=0,n=0;const o=this.parentEntity.getComponent("equipment");if(o){const e=o.getEquippables();for(const o of e)t+=o.minDamage,n+=o.maxDamage}this.minDamage=e+t,this.maxDamage=Math.floor(1.5*e)+n}calculateDefense(){const e=this.baseDefense;let t=0;const n=this.parentEntity.getComponent("equipment");if(n){const e=n.getEquippables();for(const n of e)t+=n.defense}this.defense=e+t}updateUI(){console.log("Update: ",this),this.isPlayer()?(Re.updateHealth(this.hp,this.maxHp),Re.updatePower(this.getDamageDisplay()),Re.updateDefense(this.defense)):"hero"===this.parentEntity.id&&(Be.updateHealth(this.hp,this.maxHp),Be.updatePower(this.getDamageDisplay()),Be.updateDefense(this.defense))}onComponentsLoaded(){this.recalculateStats(!1)}onEquipmentChange(){this.recalculateStats()}}const We=new class{constructor(){this.types=new Map,this.init()}init(){this.load(new Me),this.load(new qe),this.load(new Pe),this.load(new Oe),this.load(new He),this.load(new je),this.load(new Ue),this.load(new Ye),this.load(new ye),this.load(new Te)}load(e){this.types.set(e.type,e)}create(e,t,n){return new(0,this.types.get(t).constructor)(n)}},Je=new class extends w{constructor(){super('<div class="ui details"></div>')}updatePlayerDetails(){}getPosition(e){const t=e.getComponent("position");return"<span class='details__line'>Looking at: X:"+t.x+" - Y:"+t.y+"</span>"}updatePositionOnly(e){this.dom.innerHTML=this.getPosition(e)}updatePositionDetails(){}},Ge=new class{constructor(){this.setupGameHtml(),this.resizeCanvas(),window.addEventListener("resize",this)}setupGameHtml(){const e=document.createElement("div");e.classList.add("game"),this.canvas=document.createElement("canvas"),this.canvas.classList.add("view"),e.appendChild(this.canvas),Be.open(),Be.appendTo(e),Re.open(),I.open(),x.open(),Je.open(),Re.appendTo(Je.dom),I.appendTo(Je.dom),x.appendTo(Je.dom),Je.appendTo(e),document.body.appendChild(e),this.ctx=this.canvas.getContext("2d")}handleEvent(e){"resize"===e.type&&this.resizeCanvas()}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,H.xScale=this.canvas.width/2560,H.yScale=this.canvas.height/1440,H.needsRenderUpdate=!0}clearAll(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}};class Xe{constructor(e){this.args=e,this.type=e.type||"entity",this.id=e.id,this.name=e.name||"",this.description=e.description||"",this.sprite=e.sprite||"",this.letter=e.letter||"?",this.color=e.color||"#fff",this.componentArray=[],this.components={},e.components&&(this.loadComponents(e,e.components),this.callEvent("onComponentsLoaded")),this.cachedSave=null}clone(){console.error("Not implemented")}callEvent(e,t){for(const n of this.componentArray)n[e]?.(t);this[e]?.(t)}draw(e,t){const n=this.getComponent("position");n&&H.spriteManager.getImage(this.sprite).drawImage(Ge.ctx,64*(n.x+e),64*(n.y+t))}loadComponents(e,t){const n=this;Object.keys(t).forEach((function(t){const o=We.types.get(t);if(o){const s=o.baseType;n.getComponent(s)||n.setComponent(We.create(this,t,e),!1)}}))}setComponent(e){e.parentEntity=this,this.components[e.baseType]=e,this.componentArray.push(e)}getComponent(e){return this.components[e]}removeComponent(e){if(this.components[e]){this.components[e]=void 0;for(const t of this.componentArray)if(t.baseType===e){const e=this.componentArray.indexOf(t);this.componentArray.splice(e,1);break}}}clearSaveCache(){this.cachedSave=null}save(){if(null!==this.cachedSave)return this.cachedSave;const e={id:this.id,type:this.type,name:this.name,description:this.description,sprite:this.sprite,letter:this.letter,color:this.color,components:{}};for(const t of this.componentArray){const n=t.save();null!==n&&n!=={}&&Ce.deep(e.components,n)}return this.cachedSave=e,e}loadArg(e,t){return this.args[e]||t}}class Ve extends Xe{constructor(e={}){e.type="actor",super(e),this.fov=new ke}clone(){return new Ve(this.save())}isAlive(){const e=this.getComponent("fighter");return e&&e.hp>0}}class Ze extends Xe{constructor(e={}){e.type="tile",super(e)}clone(){return new Ze(this.save())}save(){return super.save()}isWall(){return this.getComponent("blocksMovement")?.blocksMovement}}const Ke=JSON.parse('[{"id":"base_actor","type":"actor","sprite":"placeholder","components":{"blocksMovement":true,"fighter":{}}},{"id":"base_interactable","type":"actor","sprite":"placeholder","components":{"blocksMovement":false}}]'),Qe=JSON.parse('[{"id":"rat","extends":"base_actor","name":"Rat","sprite":"rltiles_giant_rat","components":{"faction":{"factions":"monsters","enemies":"hero"},"aiMeleeChase":{"radius":3,"movementActions":2},"fighter":{"baseHp":10,"baseDamage":2},"level":{"xpGiven":10}}},{"id":"rat_small","extends":"base_actor","name":"Small Rat","sprite":"rltiles_sewer_rat","components":{"faction":{"factions":"monsters","enemies":"hero"},"aiMeleeChase":{"radius":3,"movementActions":2},"fighter":{"baseHp":5,"baseDamage":1},"level":{"xpGiven":5}}},{"id":"lizard_giant","extends":"base_actor","name":"Giant Lizard","sprite":"rltiles_giant_lizard","components":{"faction":{"factions":"monsters","enemies":"hero"},"aiMeleeChase":{"radius":3,"movementActions":2},"fighter":{"baseHp":15,"baseDamage":3},"level":{"xpGiven":15}}},{"id":"web_large","extends":"base_interactable","name":"Web","sprite":"webs_cobweb_large","components":{"cleanable":{"decreasesTo":"web"}}},{"id":"web","extends":"base_interactable","name":"Web","sprite":"webs_cobweb","components":{"cleanable":{"increasesTo":"web_large"}}},{"id":"blood_large","extends":"base_interactable","name":"Pool of Blood","sprite":"scribble_blood_3","components":{"cleanable":{"decreasesTo":"blood_medium"}}},{"id":"blood_medium","extends":"base_interactable","name":"Pool of Blood","sprite":"scribble_blood_2","components":{"cleanable":{"decreasesTo":"blood_small","increasesTo":"blood_large"}}},{"id":"blood_small","extends":"base_interactable","name":"Pool of Blood","sprite":"scribble_blood_1","components":{"cleanable":{"increasesTo":"blood_medium"}}}]'),$e=JSON.parse('[{"id":"hero","extends":"base_actor","name":"Hero","color":"#00f","letter":"@","sprite":"rltiles_barbarian","components":{"faction":{"factions":"hero","enemies":"monsters, player"},"fighter":{"baseHp":30,"baseDefense":2,"baseDamage":5},"aiHero":{}}}]'),et=JSON.parse('[{"id":"player","extends":"base_actor","name":"Player","color":"#00f","letter":"@","sprite":"rltiles_human","components":{"faction":{"factions":"player","enemies":"hero"},"fighter":{"baseHp":30,"baseDefense":2,"baseDamage":5}}}]'),tt=JSON.parse('[{"id":"base_tile","type":"tile","sprite":"placeholder","components":{"blocksMovement":true,"blocksFov":true}}]'),nt=JSON.parse('[{"id":"base_floor","extends":"base_tile","components":{"blocksMovement":false,"blocksFov":false}},{"id":"floor","extends":"base_floor","name":"Floor","color":"#ddd","sprite":"scribble_tiles"},{"id":"floor_center","extends":"base_floor","name":"Floor","color":"#ddd","sprite":"scribble_tiles_center"},{"id":"floor_cracked","extends":"base_floor","name":"Floor","color":"#ddd","sprite":"scribble_tiles_cracked"}]'),ot=JSON.parse('[{"id":"table","extends":"base_tile","name":"Table","color":"#ddd","sprite":"scribble_floor_table","components":{"blocksMovement":true,"blocksFov":false}}]'),st=JSON.parse('[{"id":"stairs_up","extends":"base_tile","sprite":"scribble_stairs_down_detail","name":"Stairs Up","components":{"blocksMovement":true,"blocksFov":false}},{"id":"stairs_down","extends":"base_tile","sprite":"scribble_stairs_down","name":"Stairs Down","components":{"blocksMovement":false,"blocksFov":false}},{"id":"trap_door","extends":"base_tile","sprite":"scribble_trap_door","name":"Trap Door","components":{"blocksMovement":false,"blocksFov":false}}]'),at=JSON.parse('[{"id":"base_wall","extends":"base_tile","components":{"blocksMovement":true,"blocksFov":true}},{"id":"wall","extends":"base_wall","name":"Wall","color":"#666","sprite":"scribble_wall_full"}]'),it=JSON.parse('[{"id":"base_item","type":"item","sprite":"placeholder","components":{}}]'),rt=JSON.parse('[{"id":"potion","extends":"base_item","maxStackSize":20,"components":{}},{"id":"potion_health","extends":"potion","sprite":"rltiles_purple_red","name":"Health Potion","description":"Recover a minor amount of health","components":{"healingConsumable":{"amount":4}}}]');class lt extends Xe{constructor(e={}){e.type="item",super(e),this.amount=this.loadArg("amount",1),this.maxStackSize=this.loadArg("maxStackSize",1)}save(){const e=super.save();return 1!==this.amount&&(e.amount=this.amount),1!==this.maxStackSize&&(e.maxStackSize=this.maxStackSize),e}clone(){return new lt(this.save())}setAmount(e){this.amount=e,this.clearSaveCache()}}const ht=new class{constructor(){this.types=new Map,this.templates=new Map,this.init()}init(){this.load(new Ve),this.load(new Ze),this.load(new lt),this.loadTemplates()}load(e){this.types.set(e.type,e)}create(e,t={}){let n;if(n="object"==typeof e?e:JSON.parse(e),void 0!==n.extends){if(this.templates.has(n.extends)){const e=JSON.parse(this.templates.get(n.extends));return delete n.extends,this.create(Ce.deep(e,n),t)}console.error("Json template for id '"+n.extends+"' is missing. Cannot extend from it.")}return new(this.types.get(n.type).constructor)(Ce.deep(n,t))}createFromTemplate(e,t={}){return this.templates.has(e)?this.create(this.templates.get(e),t):(console.error("Json template for id '"+e+"' is missing."),null)}loadTemplate(e){for(const t of e){const e=t.id;this.templates.has(e)?console.error("Template for entity id '"+e+"' already exists."):this.templates.set(e,JSON.stringify(t))}}loadTemplates(){this.loadTemplate(Ke),this.loadTemplate(Qe),this.loadTemplate($e),this.loadTemplate(et),this.loadTemplate(tt),this.loadTemplate(nt),this.loadTemplate(ot),this.loadTemplate(st),this.loadTemplate(at),this.loadTemplate(it),this.loadTemplate(rt)}};class ct extends fe{constructor(e,t=0,n=0){super(e,t,n)}perform(e){const t=this.entity.getComponent("position");if(!t)return new v(this.entity,"Entity doesn't have a position.");const n=t.x+this.dx,o=t.y+this.dy,s=e.getCleanableActorAtLocation(n,o);if(!s)return new v(this.entity,"There's nothing to clean there!");{const t=s.getComponent("cleanable");if(t){const n=t.decreasesTo;if(n){const t=s.getComponent("position"),o=ht.createFromTemplate(n,{components:{position:{x:t.x,y:t.y}}});e.addActor(o)}e.removeActor(s)}}}}class dt extends fe{constructor(e,t=0,n=0){super(e,t,n)}perform(e){const t=this.entity.getComponent("position");if(!t)return new v(this.entity,"Entity doesn't have a position.");const n=t.x+this.dx,o=t.y+this.dy;return e.getBlockingActorAtLocation(n,o)?new ve(this.entity,this.dx,this.dy).perform(e):e.getCleanableActorAtLocation(n,o)?new ct(this.entity,this.dx,this.dy).perform(e):e.tiles[n]?new be(this.entity,this.dx,this.dy).perform(e):new v(this.entity,"Nowhere to move.")}}class pt extends j{constructor(){super()}teardown(){super.teardown()}handleInput(){let e=null;return this.isPlayerTurn&&H.player.isAlive()&&(ge.testPressed("up")?e=new dt(H.player,0,-1):ge.testPressed("down")?e=new dt(H.player,0,1):ge.testPressed("left")?e=new dt(H.player,-1,0):ge.testPressed("right")?e=new dt(H.player,1,0):ge.testPressed("nw")?e=new dt(H.player,-1,-1):ge.testPressed("ne")?e=new dt(H.player,1,-1):ge.testPressed("sw")?e=new dt(H.player,-1,1):ge.testPressed("se")?e=new dt(H.player,1,1):ge.testPressed("wait")&&(e=new Ee(H.player))),e}onMouseMove(e){this.mouse.x=e.clientX,this.mouse.y=e.clientY,H.needsRenderUpdate=!0}}class _t{constructor(){}static create2dArray(e){const t=[];for(let n=0;n<e;n++)t[n]=[];return t}}class mt{constructor(e,t,n){this.name=e,this.width=t,this.height=n,this.timeout=null,this.saveCache=null,this.init()}init(){this.tiles=_t.create2dArray(this.width),this.actors=[],this.items=[]}create(){}teardown(){this.timeout&&clearTimeout(this.timeout),H.player.fov.teardown();for(let e=0;e<this.width;e++)for(let t=0;t<this.height;t++){const n=this.tiles[e][t];n&&n.callEvent("onMapTeardown")}for(const e of this.actors)e.callEvent("onMapTeardown");for(const e of this.items)e.callEvent("onMapTeardown")}removeEntity(e){e instanceof Ve?this.removeActor(e):e instanceof lt&&this.removeItem(e)}removeItem(e){const t=this.items.indexOf(e);t>-1&&this.items.splice(t,1)}addItem(e,t){const n=e.getComponent("position");t||(t=n);let o=e.amount;for(const s of this.items)if(s.id===e.id){const a=s.getComponent("position");if(a&&t.isSamePosition(a)){if(-1===s.maxStackSize)return s.setAmount(s.amount+e.amount),n.teardown(),!1;const t=s.maxStackSize-s.amount;if(t>=o)return s.setAmount(s.amount+o),n.teardown(),!1;s.setAmount(s.amount+t),e.setAmount(e.amount-t),o-=t}}return o>0?(e.setAmount(o),n.moveTo(t.x,t.y),e.parent=null,this.items.push(e),n.setVisible(),!0):(n.teardown(),!1)}removeActor(e){const t=this.actors.indexOf(e);t>-1&&this.actors.splice(t,1)}addActor(e){this.actors.push(e)}save(){const e={name:this.name,width:this.width,height:this.height,tiles:{}},t=[],n=[];let o="",s=65;for(let e=0;e<this.width;e++)for(let a=0;a<this.height;a++){const i=this.tiles[e][a];if(i){const e=JSON.stringify(i.save()),a=t.indexOf(e);a>-1?o+=n[a]:(t.push(e),n.push(String.fromCharCode(s)),o+=String.fromCharCode(s),s++)}else o+=" "}e.tiles={},e.tiles.key=o,e.tiles.map={};for(let o=0;o<t.length;o++)e.tiles.map[n[o]]=t[o];const a=[];for(const e of this.actors)a.push(JSON.stringify(e.save()));e.actors=a;const i=[];for(const e of this.items)i.push(JSON.stringify(e.save()));return e.items=i,this.saveCache=e,e}load(e){const t=e.tiles;for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const o=t[e*this.height+n];o&&(t[e][n]=ht.create(o,{components:{position:{x:e,y:n}}}))}const n=e.actors;for(const e of n){const t=ht.create(e);this.addActor(t)}const o=e.items;for(const e of o){const t=ht.create(e);this.items.push(t)}}isInBounds(e,t){return 0<=e&&e<this.width&&0<=t&&t<this.height}revealFromPosition(e,t,n,o=25){const s=this,a=Math.max(0,e-n),i=Math.min(this.width,e+n),r=Math.max(0,t-n),l=Math.min(this.height,t+n);0===o?s._revealGradually(a,i,r,l,e,t,1,n,o):s.timeout=setTimeout((function(){s._revealGradually(a,i,r,l,e,t,1,n,o)}),o)}_revealGradually(e,t,n,o,s,a,i,r,l){const h=this;h.timeout=null,i<=r&&(h.timeout=setTimeout((function(){h._revealGradually(e,t,n,o,s,a,i+1,r,l)}),l));const c=s-i,d=s+i,p=a-i,_=a+i;for(let e=c;e<=d;e++){const t=e===c||e===d;for(let n=p;n<=_;n++)(t||n===p||n===_)&&(this._revealAtPosition(e,n),H.needsMapUpdate=!0)}return!0}_revealAtPosition(e,t){if(this.tiles[1][e]){const n=this.tiles[1][e][t];n&&n.getComponent("position")&&(n.getComponent("fov")||n.setComponent(new ye({components:{fov:{explored:!0,visible:!1}}})))}}getAliveActorAtLocation(e,t){let n=null;for(const o of this.actors)if(o.isAlive()){const s=o.getComponent("position");if(s&&e===s.x&&t===s.y){n=o;break}}return n}getBlockingActorAtLocation(e,t){let n=null;for(const o of this.actors){const s=o.getComponent("position");if(s&&e===s.x&&t===s.y){const e=o.getComponent("blocksMovement");if(e&&e.blocksMovement){n=o;break}}}return n}getCleanableActorAtLocation(e,t){let n=null;for(const o of this.actors){const s=o.getComponent("position");if(s&&e===s.x&&t===s.y&&o.getComponent("cleanable")){n=o;break}}return n}addPlayer(e,t){H.player||(H.player=ht.createFromTemplate("player")),this.addActor(H.player),H.player.getComponent("position").moveTo(e,t),this.updatePlayerUI()}updatePlayerUI(){Je.updatePlayerDetails()}draw(e=0,t=0){const n=this.tiles;for(let o=0;o<n.length;o++){const s=n[o];for(let n=0;n<s.length;n++){const o=s[n];o&&o.draw(e,t)}}for(const n of this.items)n.draw(e,t);for(const n of this.actors)n.draw(e,t)}}class ut{constructor(){}placeEntities(){}}const gt=[],ft=JSON.parse('[{"id":"potion","items":[{"id":"potion_health","weight":30}]}]'),bt=JSON.parse('[{"level":1,"actors":[{"id":"rat_small","weight":50},{"id":"rat","weight":30},{"id":"lizard_giant","weight":20},{"id":"web","weight":50},{"id":"blood_large","weight":50}],"items":[{"group":"potion","weight":50}]}]'),vt=JSON.parse('[{"level":1,"actors":[{"id":"web_large","weight":50},{"id":"web","weight":50},{"id":"blood_large","weight":50},{"id":"blood_medium","weight":50},{"id":"blood_small","weight":50},{"id":"rat","weight":500}],"items":[{"group":"potion","weight":50}]}]'),At=new class{constructor(){this.entityGroups=new Map,this.itemGroups=new Map,this.generators=new Map,this.loadEntityGroups(gt),this.loadItemGroups(ft),this.loadGenerator("basic-dungeon",bt),this.loadGenerator("tutorial",vt)}loadEntityGroups(e){for(const t of e)this.entityGroups.set(t.id,t.entities)}loadItemGroups(e){for(const t of e)this.itemGroups.set(t.id,t.items)}loadGenerator(e,t){this.generators.set(e,t)}getChancesForLevel(e,t){let n;const o=this.generators.get(e);for(const e of o){if(e.level>t)break;n=e}return n}getActorForLevel(e,t){const n=this.getChancesForLevel(e,t).actors;let o=this.getRandomFromGroup(n);for(;void 0!==o.group;){const e=this.entityGroups.get(o.group);o=this.getRandomFromGroup(e)}return o.id}getItemForLevel(e,t){const n=this.getChancesForLevel(e,t).items;let o=this.getRandomFromGroup(n);for(;void 0!==o.group;){const e=this.itemGroups.get(o.group);o=this.getRandomFromGroup(e)}return o.id}getRandomFromGroup(e){let t,n=0;for(const t of e)n+=t.weight;let o=0;const s=Se.randomNumber(0,n);for(const n of e)if(o+=n.weight,s<o){t=n;break}return t}};class yt extends ut{constructor(e,t,n,o){super(),this.x1=e,this.y1=t,this.x2=e+n,this.y2=t+o,this.width=n,this.height=o}getCenterX(){return Math.round((this.x1+this.x2)/2)}getCenterY(){return Math.round((this.y1+this.y2)/2)}intersects(e){return this.x1<=e.x2&&this.x2>=e.x1&&this.y1<=e.y2&&this.y2>=e.y1}createRoom(e){const t=Math.max(0,this.x1),n=Math.min(e.width,this.x2+1),o=Math.max(0,this.y1),s=Math.min(e.height,this.y2+1),a=ht.createFromTemplate("floor",{components:{position:{x:0,y:0}}}),i=ht.createFromTemplate("floor_center",{components:{position:{x:0,y:0}}}),r=ht.createFromTemplate("floor_cracked",{components:{position:{x:0,y:0}}}),l=ht.createFromTemplate("wall",{components:{position:{x:0,y:0}}});for(let h=t;h<n;h++)for(let t=o;t<s;t++){let n;const o=Math.random();n=o<.06?r.clone():o<.1?i.clone():a.clone(),n.getComponent("position").moveTo(h,t),e.tiles[h][t]=n;const s=(h===this.x1||h===this.x2)&&t>=this.y1&&t<=this.y2,c=(t===this.y1||t===this.y2)&&h>=this.x1&&h<=this.x2,d=e.tiles[h][t];if((c||s)&&!d){const n=l.clone();n.getComponent("position").moveTo(h,t),e.tiles[h][t]=n}}}placeEntities(e,t,n,o,s){const a=Se.randomInt(o,s);for(let o=0;o<a;o++){const o=Se.randomInt(this.x1+1,this.x2-1),s=Se.randomInt(this.y1+1,this.y2-1);if(!e.getBlockingActorAtLocation(o,s)){const a={components:{position:{x:o,y:s}}},i=At.getActorForLevel(t,n),r=ht.createFromTemplate(i,a);e.addActor(r)}}}placeItems(e,t,n,o){const s=Se.randomInt(0,o);for(let o=0;o<s;o++){const o={components:{position:{x:Se.randomInt(this.x1+1,this.x2-1),y:Se.randomInt(this.y1+1,this.y2-1)}}},s=At.getItemForLevel(t,n),a=ht.createFromTemplate(s,o);e.items.push(a)}}}class wt extends mt{constructor(e,t,n={}){const o=n.level||1;super("tutorial-"+o,e,t),this.maxRooms=n.maxRooms||1,this.roomMinSize=n.roomMinSize||8,this.roomMaxSize=n.roomMaxSize||8,this.level=o,this.minMonstersByFloor=[{level:1,amount:2}],this.maxMonstersByFloor=[{level:1,amount:2}],this.minItemsByFloor=[{level:1,amount:2}],this.maxItemsByFloor=[{level:1,amount:2}]}getFloorAmount(e){let t=0;for(const n of e){if(n.level>this.level)break;t=n.amount}return t}save(){const e=super.save();return 1!==this.level&&(e.level=this.level),this.saveCache=e,e}create(e,t){super.create();const n=ht.createFromTemplate("wall",{components:{position:{x:0,y:0}}});for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){const o=n.clone();o.getComponent("position").moveTo(t,e),this.tiles[t][e]=o}const o=[];for(let e=0;e<this.maxRooms;e++){const e=Se.randomInt(this.roomMinSize,this.roomMaxSize),n=Se.randomInt(this.roomMinSize,this.roomMaxSize),s=new yt(1,1,e,n);if(s.createRoom(this),0===o.length){const e=s.getCenterX(),n=s.getCenterY();t&&t.setPosition(e,n,1),this.tiles[e][0]=ht.createFromTemplate("stairs_up",{components:{position:{x:e,y:0}}});const o=Se.randomInt(s.x1+2,s.x2-2),a=Se.randomInt(s.y1+2,s.y2-2);this.tiles[o][a]=ht.createFromTemplate("stairs_down",{components:{position:{x:o,y:a}}});let i=o,r=a;for(;i===o&&r===a;)i=Se.randomInt(s.x1+2,s.x2-2),r=Se.randomInt(s.y1+2,s.y2-2),i===o&&r===a||(this.tiles[i][r]=ht.createFromTemplate("trap_door",{components:{position:{x:i,y:r}}}));this.addPlayer(e,n);const l=ht.createFromTemplate("hero");this.addActor(l)}o.push(s)}for(const e of o)e.placeEntities(this,"tutorial",this.level,this.getFloorAmount(this.minMonstersByFloor),this.getFloorAmount(this.maxMonstersByFloor)),e.placeItems(this,"tutorial",this.level,this.getFloorAmount(this.minItemsByFloor),this.getFloorAmount(this.maxItemsByFloor))}}class xt extends mt{constructor(e,t,n={}){const o=n.level||1;super("basic-dungeon-"+o,e,t),this.maxRooms=n.maxRooms||1,this.roomMinSize=n.roomMinSize||8,this.roomMaxSize=n.roomMaxSize||8,this.level=o,this.minMonstersByFloor=[{level:1,amount:0},{level:4,amount:1},{level:7,amount:2}],this.maxMonstersByFloor=[{level:1,amount:2},{level:4,amount:3},{level:7,amount:4}],this.minItemsByFloor=[{level:1,amount:0},{level:4,amount:1},{level:6,amount:2}],this.maxItemsByFloor=[{level:1,amount:2},{level:4,amount:3},{level:6,amount:5}]}getFloorAmount(e){let t=0;for(const n of e){if(n.level>this.level)break;t=n.amount}return t}save(){const e=super.save();return 1!==this.level&&(e.level=this.level),this.saveCache=e,e}create(e,t){super.create();const n=ht.createFromTemplate("wall",{components:{position:{x:0,y:0}}});for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){const o=n.clone();o.getComponent("position").moveTo(t,e),this.tiles[t][e]=o}const o=[];for(let e=0;e<this.maxRooms;e++){const n=Se.randomInt(this.roomMinSize,this.roomMaxSize),s=Se.randomInt(this.roomMinSize,this.roomMaxSize);let a=10*e+1,i=1;e>=this.maxRooms/2&&(i=11,a-=30);const r=new yt(a,i,n,s);let l=!1;for(const e of o)if(r.intersects(e)){l=!0;break}if(!l){if(r.createRoom(this),0===o.length){const e=r.getCenterX(),n=r.getCenterY();t&&t.setPosition(e,n,1),this.tiles[e][0]=ht.createFromTemplate("stairs_up",{components:{position:{x:e,y:0}}});const o=Se.randomInt(r.x1+2,r.x2-2),s=Se.randomInt(r.y1+2,r.y2-2);this.tiles[o][s]=ht.createFromTemplate("stairs_down",{components:{position:{x:o,y:s}}})}o.push(r)}}for(const e of o)e.placeEntities(this,"basic-dungeon",this.level,this.getFloorAmount(this.minMonstersByFloor),this.getFloorAmount(this.maxMonstersByFloor)),e.placeItems(this,"basic-dungeon",this.level,this.getFloorAmount(this.minItemsByFloor),this.getFloorAmount(this.maxItemsByFloor))}}class kt extends mt{constructor(e,t,n={}){const o=n.level||1;super("tutorial-"+o,e,t),this.maxRooms=n.maxRooms||1,this.roomMinSize=n.roomMinSize||8,this.roomMaxSize=n.roomMaxSize||8,this.level=o,this.minMonstersByFloor=[{level:1,amount:2}],this.maxMonstersByFloor=[{level:1,amount:2}],this.minItemsByFloor=[{level:1,amount:2}],this.maxItemsByFloor=[{level:1,amount:2}]}getFloorAmount(e){let t=0;for(const n of e){if(n.level>this.level)break;t=n.amount}return t}save(){const e=super.save();return 1!==this.level&&(e.level=this.level),this.saveCache=e,e}create(e,t){super.create();const n=ht.createFromTemplate("wall",{components:{position:{x:0,y:0}}});for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++){const o=n.clone();o.getComponent("position").moveTo(t,e),this.tiles[t][e]=o}const o=[];for(let e=0;e<this.maxRooms;e++){const e=Se.randomInt(this.roomMinSize,this.roomMaxSize),n=Se.randomInt(this.roomMinSize,this.roomMaxSize),s=new yt(1,1,e,n);if(s.createRoom(this),0===o.length){const e=s.getCenterX(),n=s.getCenterY();t&&t.setPosition(e,n,1),this.tiles[e][n]=ht.createFromTemplate("trap_door",{components:{position:{x:e,y:n}}});for(let e=s.x1+2;e<s.x2-1;e++)this.tiles[e][3]=ht.createFromTemplate("table",{components:{position:{x:e,y:3}}}),this.tiles[e][7]=ht.createFromTemplate("table",{components:{position:{x:e,y:7}}})}o.push(s)}}}!function(){function e(){H.handleEvents(),H.spriteManager.preloadSprites()&&H.needsRenderUpdate&&(Ge.clearAll(),H.draw(),H.needsRenderUpdate=!1),window.requestAnimationFrame(e)}!function(){H.initTextures(),H.setHeroMap(new wt(11,11)),H.setNextMap(new xt(11,11)),H.setShopMap(new kt(11,11)),H.player=ht.createFromTemplate("player",{components:{position:{x:0,y:0}}}),H.heroMap.create(),H.nextMap.create(),H.shopMap.create(),H.playerMap=H.heroMap,H.heroMap.actors.push(H.player),H.eventHandler=new pt,I.updatePlayerDetails(),C.text("Welcome to the dungeon.").build(),H.needsRenderUpdate=!0;const t=H.player.getComponent("position");H.heroMap.revealFromPosition(t.x,t.y,20,0),H.player.fov.compute(H.playerMap,t.x,t.y,5),H.player.fov.updateMap(),window.requestAnimationFrame(e)}()}()}},e=>{e(e.s=594)}]);
//# sourceMappingURL=app.e3854ccae05195573fbf.js.map